<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<meta name="author" content="SÃ©bastien Millet">
<title>Cryptographie pratique</title>
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
</head>
<body class="article">
<div id="header">
<h1>Cryptographie pratique</h1>
<div class="details">
<span id="author" class="author">SÃ©bastien Millet</span><br>
<span id="email" class="email">&lt;<a href="mailto:milletseb@laposte.net">milletseb@laposte.net</a>&gt;</span><br>
<span id="revnumber">version 1.0.1,</span>
<span id="revdate">26 mars 2016</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_pourquoi_un_tel_document">1.1. Pourquoi un tel document</a></li>
<li><a href="#_contenu">1.2. Contenu</a></li>
</ul>
</li>
<li><a href="#_le_format_x509">2. Le format x509</a>
<ul class="sectlevel2">
<li><a href="#_visualisation_d_un_certificat_x509">2.1. Visualisation d&#8217;un certificat x509</a></li>
<li><a href="#_structure_d_un_certificat_x509">2.2. Structure d&#8217;un certificat x509</a></li>
<li><a href="#_hiÃ©rarchie_des_certificats">2.3. HiÃ©rarchie des certificats</a></li>
</ul>
</li>
<li><a href="#_vÃ©rification_de_signature_rsa">3. VÃ©rification de signature RSA</a>
<ul class="sectlevel2">
<li><a href="#_la_signature_rsa">3.1. La signature RSA</a>
<ul class="sectlevel3">
<li><a href="#_calcul_de_la_signature">3.1.1. Calcul de la signature</a></li>
<li><a href="#_vÃ©rification_de_la_signature">3.1.2. VÃ©rification de la signature</a></li>
</ul>
</li>
<li><a href="#_vÃ©rification_du_certificat_de_letsencrypto_org">3.2. VÃ©rification du certificat de letsencrypto.org</a>
<ul class="sectlevel3">
<li><a href="#_choix_d_un_programme_de_calcul">3.2.1. Choix d&#8217;un programme de calcul</a></li>
<li><a href="#_enregistrement_de_la_signature_sous_forme_d_entier">3.2.2. Enregistrement de la signature sous forme d&#8217;entier</a></li>
<li><a href="#_enregistrement_de_la_clÃ©_publique_sous_forme_d_entier">3.2.3. Enregistrement de la clÃ© publique sous forme d&#8217;entier</a></li>
<li><a href="#_la_fonction_em_powmod_em">3.2.4. La fonction <em>powmod</em></a></li>
<li><a href="#_calcul_de_em_m_em">3.2.5. Calcul de <em>M</em></a></li>
<li><a href="#_analyse_de_em_m_em">3.2.6. Analyse de <em>M</em></a></li>
<li><a href="#_calcul_de_em_m_em_2">3.2.7. Calcul de <em>M'</em></a></li>
</ul>
</li>
<li><a href="#_conclusion">3.3. Conclusion</a></li>
</ul>
</li>
<li><a href="#_vÃ©rification_de_signature_ecdsa">4. VÃ©rification de signature ECDSA</a>
<ul class="sectlevel2">
<li><a href="#_cryptographie_Ã _courbes_elliptiques">4.1. Cryptographie Ã  courbes elliptiques</a>
<ul class="sectlevel3">
<li><a href="#_les_deux_familles_de_courbes_elliptiques">4.1.1. Les deux familles de courbes elliptiques</a></li>
<li><a href="#_les_paramÃ¨tres_de_domaine">4.1.2. Les paramÃ¨tres de domaine</a></li>
<li><a href="#_l_arithmÃ©tique_des_courbes_sur_em_f_sub_p_sub_em">4.1.3. L&#8217;arithmÃ©tique des courbes sur <em>F<sub>p</sub></em></a></li>
<li><a href="#_fonctions_de_calcul_sur_em_f_sub_p_sub_em_avec_le_programme_em_bc_em">4.1.4. Fonctions de calcul sur <em>F<sub>p</sub></em> avec le programme <em>bc</em></a></li>
</ul>
</li>
<li><a href="#_les_courbes_elliptiques_dans_le_standard_x509">4.2. Les courbes elliptiques dans le standard x509</a>
<ul class="sectlevel3">
<li><a href="#_reprÃ©sentation_d_un_point_dans_le_standard_x509">4.2.1. ReprÃ©sentation d&#8217;un point dans le standard x509</a></li>
<li><a href="#_la_courbe_prime256v1_secp256r1">4.2.2. La courbe prime256v1 (secp256r1)</a></li>
<li><a href="#_crÃ©ation_d_un_certificat_auto_signÃ©">4.2.3. CrÃ©ation d&#8217;un certificat auto-signÃ©</a></li>
<li><a href="#_vÃ©rification_de_la_signature_ecdsa_du_certificat">4.2.4. VÃ©rification de la signature ECDSA du certificat</a></li>
</ul>
</li>
<li><a href="#_les_certificats_Ãlectroniques_visibles">4.3. Les Certificats Ãlectroniques Visibles</a>
<ul class="sectlevel3">
<li><a href="#_prÃ©sentation">4.3.1. PrÃ©sentation</a></li>
<li><a href="#_vÃ©rification_manuelle_d_une_signature_2d_doc">4.3.2. VÃ©rification manuelle d&#8217;une signature 2D-Doc</a></li>
<li><a href="#_vÃ©rification_d_une_signature_2d_doc_avec_em_openssl_em">4.3.3. VÃ©rification d&#8217;une signature 2D-Doc avec <em>openssl</em></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_bibliographie">5. Bibliographie</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_pourquoi_un_tel_document">1.1. Pourquoi un tel document</h3>
<div class="paragraph">
<p>Faire des calculs Ã  la main sur des signatures Ã©lectroniques est trÃ¨s ludique.</p>
</div>
<div class="paragraph">
<p>Il faut s&#8217;entendre sur le terme "Ã  la main". Au fil du document nous ne ferons aucun calcul Ã  la main ni mÃªme avec une calculatrice de bureau. Les nombres manipulÃ©s sont beaucoup trop grands.
MÃªme Ã  supposer que l&#8217;on dÃ©cide d&#8217;utiliser une calculatrice de bureau (la chose est sans doute possible, en transfÃ©rant les donnÃ©es depuis un PC), il faudrait la programmer en raison du nombre d&#8217;Ã©tapes de calcul.</p>
</div>
</div>
<div class="sect2">
<h3 id="_contenu">1.2. Contenu</h3>
<div class="paragraph">
<p>Cet article dÃ©crit les calculs Ã  faire pour vÃ©rifier des signatures RSA et ECDSA, dans le cadre x509 et 2D-Doc.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">RSA, ECDSA</dt>
<dd>
<p><em>RSA</em> et <em>ECDSA</em> permettent de signer <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup>
avec une paire de clÃ©s privÃ©e et publique.
La clÃ© privÃ©e est utilisÃ©e pour signer. La clÃ© publique permet de vÃ©rifier la signature.</p>
</dd>
</dl>
</div>
<div class="olist arabic">
<div class="title">Nous examinerons trois cas de signatures Ã©lectroniques&#160;:</div>
<ol class="arabic">
<li>
<p><em>RSA</em> dans le contexte x509&#160;: cas du certificat d&#8217;un serveur https</p>
</li>
<li>
<p><em>ECDSA</em> dans le contexte x509&#160;: crÃ©ation d&#8217;un certificat x509 auto-signÃ©, afin de se familiariser avec les calculs sur les courbes elliptiques</p>
</li>
<li>
<p><em>ECDSA</em> dans le contexte 2D-Doc&#160;: vÃ©rification d&#8217;un code 2D-Doc, qui est le standard du Certificat Ãlectronique Visible</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Au fil du document nous ferons appel aux outils suivants&#160;:</div>
<ul>
<li>
<p><em>openssl</em> pour travailler sur les certificats x509 en ligne de commande</p>
</li>
<li>
<p><em>pkfile</em> pour extraire la partie signÃ©e d&#8217;un certificat et <em>dder</em> pour afficher certains contenus binaires</p>
</li>
<li>
<p><em>python</em> ou <em>bc</em> pour faire des calculs avec des nombres entiers de grande taille</p>
</li>
<li>
<p>Conversion entre encodage <em>PEM</em> et encodage <em>binaire</em> (Linux&#160;: <em>base64</em>, Windows&#160;: <em>notepad++</em>)</p>
</li>
<li>
<p>Ãdition de contenu de fichier binaire (Linux&#160;: <em>gvim/xxd</em>, Windows&#160;: <em>notepad++</em>)</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Windows versus Linux</div>
<div class="paragraph">
<p>Ce document s&#8217;adresse aux utilisateurs de Windows et Linux.</p>
</div>
<div class="paragraph">
<p>Il peut arriver que l&#8217;outil ou la commande Ã  employer diffÃ¨re entre les deux environnements, dans ce cas les deux sont prÃ©sentÃ©s.</p>
</div>
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_le_format_x509">2. Le format x509</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_visualisation_d_un_certificat_x509">2.1. Visualisation d&#8217;un certificat x509</h3>
<div class="paragraph">
<p>A l&#8217;aide d&#8217;un navigateur, ouvrir une page en https et afficher le certificat.
Les exemples de ce document sont rÃ©alisÃ©s avec le certificat https du site <a href="https://letsencrypt.org/" class="bare">https://letsencrypt.org/</a>.</p>
</div>
<div class="olist arabic">
<div class="title">Exemple avec Firefox 44</div>
<ol class="arabic">
<li>
<p>Cliquer sur l&#8217;icÃ´ne de cadenas Ã  gauche de la barre d&#8217;adresse et cliquer sur la flÃ¨che droite (Figure 1)</p>
</li>
<li>
<p>Cliquer sur <em>Plus d&#8217;informations</em> (Figure 2)</p>
</li>
<li>
<p>Cliquer sur <em>Afficher le certificat</em> (Figure 3)</p>
</li>
<li>
<p>Afficher l&#8217;onglet <em>DÃ©tails</em> et parcourir les diffÃ©rents champs du certificat (Figure 4, 5 et 6)</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-firefox-1-redim.png" alt="Image Firefox 1">
</div>
<div class="title">Fig. 1 </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-firefox-2-redim.png" alt="Image Firefox 2">
</div>
<div class="title">Fig. 2 </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-firefox-3-redim.png" alt="Image Firefox 3">
</div>
<div class="title">Fig. 3 </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-firefox-4-redim.png" alt="Image Firefox 4">
</div>
<div class="title">Fig. 4 </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-firefox-5-redim.png" alt="Image Firefox 5">
</div>
<div class="title">Fig. 5 </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-firefox-6-redim.png" alt="Image Firefox 6">
</div>
<div class="title">Fig. 6 </div>
</div>
<div class="paragraph">
<p>Nous nous intÃ©resserons Ã  la partie supÃ©rieure (<em>HiÃ©rarchie des certificats</em>) plus tard.</p>
</div>
<div class="paragraph">
<p>Pour le moment examinons le certificat. L&#8217;affichage de Firefox en dessous de <em>Champs du certificat</em> liste trois parties&#160;:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Le certificat proprement dit, qui contient beaucoup d&#8217;informations structurÃ©es sur plusieurs niveaux hiÃ©rarchiques</p>
</li>
<li>
<p>L&#8217;algorithme de signature du certificat, dans notre exemple, <em>PKCS #1 SHA-256 avec chiffrement RSA</em></p>
</li>
<li>
<p>La signature du certificat, ici, une suite de 256 octets</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Cette structure en trois parties est toujours respectÃ©e pour un certificat x509.
A noter qu&#8217;Internet Explorer et Chrome affichent les mÃªmes informations mais sans faire ressortir la structure trois parties.</p>
</div>
</div>
<div class="sect2">
<h3 id="_structure_d_un_certificat_x509">2.2. Structure d&#8217;un certificat x509</h3>
<div class="paragraph">
<p>OÃ¹ la structure d&#8217;un certificat est-elle dÃ©finie, et quelle est cette dÃ©finition ?</p>
</div>
<div class="paragraph">
<p>Une recherche sur un moteur de recherche avec les mots-clÃ©s <em>RFC</em> et <em>x509</em> produit l&#8217;URL suivante dans les premiÃ¨res rÃ©ponses&#160;:</p>
</div>
<div class="paragraph">
<p><a href="https://tools.ietf.org/html/rfc5280" class="bare">https://tools.ietf.org/html/rfc5280</a></p>
</div>
<div class="paragraph">
<p>Et effectivement la<sup class="footnote">[<a id="_footnoteref_2" class="footnote" href="#_footnote_2" title="View footnote.">2</a>]</sup>
<strong>RFC 5280</strong> dÃ©finit le format x509 version 3.</p>
</div>
<div class="paragraph">
<p>Affichons-la. Dans la section <em>4.1</em> se trouve la dÃ©finition suivante.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>...
4.1.  Basic Certificate Fields

   The X.509 v3 certificate basic syntax is as follows.  For signature
   calculation, the data that is to be signed is encoded using the ASN.1
   distinguished encoding rules (DER) [X.690].  ASN.1 DER encoding is a
   tag, length, value encoding system for each element.

Certificate  ::=  SEQUENCE  {
	tbsCertificate       TBSCertificate,
	signatureAlgorithm   AlgorithmIdentifier,
	signatureValue       BIT STRING  }
...</pre>
</div>
</div>
<div class="paragraph">
<p>La suite dÃ©finit les diffÃ©rents Ã©lÃ©ments du certificat, Ã  savoir <em>TBSCertificate</em> et <em>AlgorithmIdentifier</em>.</p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Grammaire, ASN.1 et DER</div>
<div class="paragraph">
<p>La structure du certificat est dÃ©crite par une <em>grammaire</em>, d&#8217;aprÃ¨s les rÃ¨gles de syntaxe <strong>ASN.1</strong> (<em>Abstrat&#160;Syntax&#160;Notation&#160;number&#160;1</em>)&#160;<a href="#1">[1]</a>.</p>
</div>
<div class="paragraph">
<p>Les diffÃ©rents encodages possibles du standard <em>ASN.1</em> sont eux-mÃªmes des standards et le <strong>X.690</strong> est l&#8217;un d&#8217;entre eux&#160;<a href="#2">[2]</a>.</p>
</div>
<div class="paragraph">
<p>La RFC prÃ©cise que la partie du certificat Ã  signer doit Ãªtre encodÃ©e selon le standard <em>Distinguished Encoding Rules</em> ou <strong>DER</strong>. Entre autres encodages, le document X.690 dÃ©finit le DER.</p>
</div>
<div class="paragraph">
<p>Nous verrons plus loin l&#8217;encodage DER.
Si vous souhaitez le dÃ©couvrir, plutÃ´t que d&#8217;examiner directement le document X.690, je vous recommande de commencer par l&#8217;article WikipÃ©dia&#160;<a href="#3">[3]</a>.</p>
</div>
</div>
</div>
<div class="paragraph">
<p>En ASN.1 le mot-clÃ© <code>SEQUENCE</code> sans autre prÃ©cision indique que la valeur est constituÃ©e d&#8217;une suite de valeurs elles-mÃªmes spÃ©cifiÃ©es en ASN.1. La valeur <em>Certificate</em> contient donc, Ã  la suite&#160;:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>La valeur <em>tbsCertificate</em>, soit le certificat Ã  signer (<strong>t</strong>o <strong>b</strong>e <strong>s</strong>igned <strong>Certificate</strong>)</p>
</li>
<li>
<p>La valeur <em>signatureAlgorithm</em>, soit l&#8217;identification de l&#8217;algorithme de signature</p>
</li>
<li>
<p>La valeur <em>signatureValue</em>, soit la signature elle-mÃªme</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_hiÃ©rarchie_des_certificats">2.3. HiÃ©rarchie des certificats</h3>
<div class="paragraph">
<p>Dans la partie tbsCertificate de <em>letsencrypt.org</em>, intÃ©ressons-nous Ã  deux Ã©lÃ©ments en particulier, l'<em>Ã©metteur</em> du certificat et le <em>sujet</em> du certificat.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Le <em>sujet</em> du certificat a pour CN (<em>Common Name</em>) letsencrypt.org et c&#8217;est le dernier nom qui est affichÃ© dans la hiÃ©rarchie des certificats (partie supÃ©rieure de la fenÃªtre).</p>
</li>
<li>
<p>L'<em>Ã©metteur</em> du certificat a pour CN <em>TrustID Server CA A52</em> et on peut voir ce nom au-dessus de letsencrypt.org dans la hiÃ©rarchie.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>L&#8217;Ã©metteur et le sujet ont Ã©galement le pays &#169; et l&#8217;organisation (O) dÃ©finis dans leur nom, ainsi que d&#8217;autres Ã©lÃ©ments.
Le "nom simple" ou "nom court" du certificat est son CN. Le standard x509 ne dÃ©finit pas cette notion de "nom simple" ou "nom court", nous l&#8217;employons ici pour prÃ©ciser que dans la pratique, le CN est le vÃ©ritable nom du certificat, les autres Ã©lÃ©ments donnant des informations annexes.</p>
</div>
<div class="paragraph">
<p>Cela dit, le nom (au sens du standard x509) est constituÃ© du DN (<em>Distinguished Name</em>), il s&#8217;agit de la <em>la totalitÃ© des Ã©lÃ©ments qui le composent</em> (et non pas seulement du CN).</p>
</div>
<div class="paragraph">
<p>Le lien hiÃ©rarchique est toujours Ã©tabli entre un Ã©metteur et un sujet.
L&#8217;Ã©metteur est celui qui signe le certificat, le sujet est celui qui est signÃ©. Voir figures 7 et 8.</p>
</div>
<div class="paragraph">
<p>Un certificat peut Ãªtre Ã  la fois Ã©metteur (d&#8217;autres certificats sont signÃ©s par lui) et sujet (il est lui-mÃªme signÃ© par un autre certificat), et cette chaÃ®ne forme une structure hiÃ©rarchique.
Dans notre exemple, on voit que le certificat <em>TrustID Server CA A52</em> est lui-mÃªme signÃ© par <em>IdenTrust Commercial Root CA 1</em>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>Dans la pratique la situation peut se compliquer avec des certificats croisÃ©s.</p>
</li>
<li>
<p>Un cas particulier est celui oÃ¹ l&#8217;Ã©metteur et le sujet sont identiques. Ce sont les certificats <em>auto-signÃ©s</em>. C&#8217;est le cas des certificats racine (en haut de la hiÃ©rarchie) et parfois d&#8217;autres certificats auto-signÃ©s pour toutes sortes de raisons bonnes ou mauvaises (souvent mauvaises, mais il existe des cas lÃ©gitimes).</p>
</li>
<li>
<p>Quoi qu&#8217;il en soit, la structure de base des liens qui relient les certificats est hiÃ©rarchique.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Quelques prÃ©cisions</div>
<div class="ulist">
<ul>
<li>
<p>Pour qu&#8217;un certificat joue le rÃ´le Ã©metteur, il doit Ãªtre une autoritÃ© de certification ou CA (<em>Certificate Authority</em>), il s&#8217;agit de l&#8217;une des nombreuses options que l&#8217;on peut trouver dans un certificat.</p>
</li>
<li>
<p>En plus des Ã©lÃ©ments permettant d&#8217;identifier le sujet du certificat, la partie tbsCertificate contient sa <em>clÃ© publique</em>. C&#8217;est prÃ©cisÃ©ment le rÃ´le du certificat&#160;: <em>certifier</em> la correspondance entre une entitÃ© (un DN) et une clÃ© publique.</p>
</li>
<li>
<p>L&#8217;Ã©metteur (qui est forcÃ©ment une autoritÃ© de certification) a toujours un numÃ©ro d&#8217;identification de clÃ© (<em>Subject Key Identifier</em>). Cet identifiant, qui doit Ãªtre par construction un entier, doit Ãªtre enregistrÃ© dans les certificats Ã©mis comme numÃ©ro de clÃ© d&#8217;autoritÃ© de certification (<em>Authority Key Identifier</em>). Cette logique permet de gÃ©rer facilement les cas oÃ¹ une autoritÃ© de certification possÃ¨de plusieurs clÃ©s.</p>
<div class="ulist">
<ul>
<li>
<p>En rÃ©sumÃ©, quand un Ã©metteur signe un sujet, on doit avoir Ã©galitÃ© entre ces diffÃ©rents Ã©lÃ©ments</p>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 44.4444%;">
<col style="width: 11.1111%;">
<col style="width: 44.4445%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Dans le certificat Ã©metteur</th>
<th class="tableblock halign-center valign-top">Lien</th>
<th class="tableblock halign-center valign-top">Dans le certificat sujet</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subject DN
<sup class="footnote">[<a id="_footnoteref_3" class="footnote" href="#_footnote_3" title="View footnote.">3</a>]</sup></p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issuer DN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Subject Key Identifier</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock">=</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authority Key Identifier</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>La RFC 5280 (<a href="#4">[4]</a>) impose l&#8217;emploi d&#8217;identifiants de clÃ© lors de l&#8217;Ã©mission de certificats mais la section <em>4.2.1.2</em> indique aussi que les applications ne sont pas obligÃ©es de vÃ©rifier les identifiants de clÃ© lors de la validation d&#8217;une chaÃ®ne de certification. Conclusion&#160;? Il n&#8217;y en a pas.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-crt-1-redim.png" alt="Image certificat : sujet">
</div>
<div class="title">Fig. 7 : Sujet du certificat </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-crt-2-redim.png" alt="Image certificat : Ã©metteur">
</div>
<div class="title">Fig. 8 : Ãmetteur du certificat </div>
</div>
<div class="paragraph">
<p>Pour signer, l&#8217;Ã©metteur utilise sa clÃ© privÃ©e. La vÃ©rification de la signature est faite avec sa clÃ© publique.
Ainsi pour vÃ©rifier l&#8217;authenticitÃ© du certificat https de <em>letsencrypt.org</em>, nous aurons besoin de la clÃ© publique de son Ã©metteur, <em>TrustID Server CA A52</em>.</p>
</div>
<div class="paragraph">
<p>Ce principe est toujours respectÃ© avec les certificats x509, que ce soit avec RSA ou d&#8217;autres mÃ©canismes Ã  clÃ© publique / clÃ© privÃ©e.</p>
</div>
<div class="paragraph">
<p>Nous allons maintenant passer Ã  la vÃ©rification de la signature RSA.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vÃ©rification_de_signature_rsa">3. VÃ©rification de signature RSA</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_la_signature_rsa">3.1. La signature RSA</h3>
<div class="sidebarblock">
<div class="content">
<div class="title">Notations</div>
<div class="ulist">
<ul>
<li>
<p>La valeur Ã  signer (ou si l&#8217;on prÃ©fÃ¨re, le <em>bloc de donnÃ©es</em> Ã  signer) est <strong>tbsCertificate</strong>, soit le certificat sans les informations de signature. Dans la structure en trois parties de notre certificat x509, c&#8217;est la premiÃ¨re.</p>
</li>
<li>
<p>L&#8217;entitÃ© qui signe le certificat (l&#8217;Ã©metteur du certificat) a pour clÃ© RSA <strong>(n, e)</strong> (<strong>n</strong> est le modulo, <strong>e</strong> est l&#8217;exposant) et <strong>d</strong>.
Le couple <strong>(n, e)</strong> est la clÃ© publique, <strong>d</strong> est la clÃ© privÃ©e.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>La page WikipÃ©dia consacrÃ©e au systÃ¨me RSA&#160;<a href="#5">[5]</a> explique le lien entre <em>(n, e)</em> et <em>d</em>, et nous indique le calcul Ã  effectuer pour <em>chiffrer</em>.
Pour <em>signer</em>, le calcul inverse le rÃ´le de l&#8217;exposant privÃ© et public, et pour <em>vÃ©rifier</em> la signature, le rÃ´le des exposants privÃ© et public est encore inversÃ© (par rapport Ã  la signature).</p>
</div>
<div class="paragraph">
<p>Dans notre exemple le tbsCertificate est celui de <em>letsencrypt.org</em>, tandis que la clÃ© RSA (clÃ© publique <em>(n, e)</em> et clÃ© privÃ©e <em>d</em>) est celle de <em>TrustID Server CA A52</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_calcul_de_la_signature">3.1.1. Calcul de la signature</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>L&#8217;Ã©metteur calcule le hash (notÃ© <em>M</em>) de la valeur <em>tbsCertificate</em> du sujet, soit <em>M&#160;=&#160;hash("tbsCertificate")</em></p>
</li>
<li>
<p>Il calcule la signature
<sup class="footnote">[<a id="_footnoteref_4" class="footnote" href="#_footnote_4" title="View footnote.">4</a>]</sup>
<sup class="footnote">[<a id="_footnoteref_5" class="footnote" href="#_footnote_5" title="View footnote.">5</a>]</sup>
(notÃ©e <em>S</em>) avec la formule <em>S&#160;=&#160;M<sup>d</sup> mod n</em></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="_vÃ©rification_de_la_signature">3.1.2. VÃ©rification de la signature</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Le vÃ©rificateur calcule <em>M&#160;=&#160;S<sup>e</sup>&#160;mod&#160;n</em></p>
</li>
<li>
<p>Il calcule <em>M'&#160;=&#160;hash("tbsCertificate")</em></p>
</li>
<li>
<p>Si on a l&#8217;Ã©galitÃ© <em>M&#160;=&#160;M'</em>, la signature est vÃ©rifiÃ©e</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_vÃ©rification_du_certificat_de_letsencrypto_org">3.2. VÃ©rification du certificat de letsencrypto.org</h3>
<div class="sect3">
<h4 id="_choix_d_un_programme_de_calcul">3.2.1. Choix d&#8217;un programme de calcul</h4>
<div class="paragraph">
<p>Nous avons besoin d&#8217;une "calculatrice" qui calcule sur des nombres entiers arbitrairement grands, sans perte de prÃ©cision. Dans la suite de ce document, c&#8217;est <em>bc</em> qui sera utilisÃ©&#160;<a href="#6">[6]</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Linux&#160;: <em>bc</em> est disponible par dÃ©faut sur la plupart des distributions.</p>
</li>
<li>
<p>Windows&#160;: les binaires sont accessibles ici&#160;<a href="#7">[7]</a>.
La version standard de <em>bc</em> (GnuWin32) gÃ¨re mal le clavier franÃ§ais. La rÃ©fÃ©rence <a href="#7">[7]</a> vous propose un exÃ©cutable <em>bc.exe</em> qui n&#8217;a pas ce dÃ©faut.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Le choix de bc</div>
<div class="ulist">
<ul>
<li>
<p><em>bc</em> est installÃ© par dÃ©faut sur la plupart des distributions Linux, et facile et rapide Ã  installer sous Windows (si ce n&#8217;est les problÃ¨mes de clavier franÃ§ais).</p>
</li>
<li>
<p><em>bc</em> contient peu de fonctions mathÃ©matiques intÃ©grÃ©es mais sur Internet on trouve de nombreux scripts qui permettent de l&#8217;enrichir considÃ©rablement.</p>
<div class="ulist">
<ul>
<li>
<p>Dans <em>bc</em> la variable <em>scale</em> dÃ©finit le nombre de dÃ©cimales des nombres manipulÃ©s. Comme nous ne ferons que des calculs sur des entiers, nous laisserons <em>scale</em> Ã  zÃ©ro (pas de partie dÃ©cimale). ZÃ©ro est la valeur par dÃ©faut de <em>scale</em> au lancement de <em>bc</em>
<sup class="footnote">[<a id="_footnoteref_6" class="footnote" href="#_footnote_6" title="View footnote.">6</a>]</sup>
.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Alternatives Ã  bc</div>
<div class="ulist">
<ul>
<li>
<p><strong>sagemath</strong>, logiciel mathÃ©matique en licence GPL.</p>
</li>
<li>
<p><strong>python</strong>, langage de programmation en licence GPL, calcule par dÃ©faut sur des entiers de taille arbitrairement grande et convient donc aux calculs que nous allons faire. Beaucoup de tuto sur Internet utilisent <em>python</em>.</p>
</li>
<li>
<p>Logiciels mathÃ©matiques propriÃ©taires bien connus.</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Comparaison entre <em>bc</em> et <em>python</em></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">bc</th>
<th class="tableblock halign-center valign-top">python</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">Saisie d&#8217;un entier en hexadÃ©cimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ExÃ©cuter au prÃ©alable
</p><p class="tableblock"><code>ibase = 2 * 8</code> <sup class="footnote" id="_footnote_ibase16">[<a id="_footnoteref_7" class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</sup>
</p><p class="tableblock">Exemple&#160;:
</p><p class="tableblock"><code>ibase = 2 * 8</code>
</p><p class="tableblock"><code>var = ABEF0E0</code>
</p><p class="tableblock"><em>(Attention les caractÃ¨res hexadÃ©cimaux doivent Ãªtre en majuscule.)</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Saisir l&#8217;entier prÃ©cÃ©dÃ© de <em>0x</em>
</p><p class="tableblock">Exemple&#160;:
</p><p class="tableblock"><code>&gt;&gt;&gt; var = 0xabef0e0</code>
<sup class="footnote">[<a id="_footnoteref_8" class="footnote" href="#_footnote_8" title="View footnote.">8</a>]</sup></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top" colspan="2"><p class="tableblock">Affichage d&#8217;entier en hexadÃ©cimal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ExÃ©cuter au prÃ©alable
</p><p class="tableblock"><code>obase = 2 * 8</code>
<sup class="footnoteref">[<a class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</sup>
</p><p class="tableblock">Exemple&#160;:
</p><p class="tableblock"><code>obase = 2 * 8</code>
</p><p class="tableblock"><code>2 ^ (2 ^ 4) + 1</code>
<sup class="footnote">[<a id="_footnoteref_9" class="footnote" href="#_footnote_9" title="View footnote.">9</a>]</sup>
</p><p class="tableblock"><code>10001</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interpoler avec <em>%x</em>
</p><p class="tableblock">Exemple&#160;:
</p><p class="tableblock"><code>>>> '%x' % (2 ** (2 ** 4) + 1)</code>
</p><p class="tableblock"><code>'10001'</code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_enregistrement_de_la_signature_sous_forme_d_entier">3.2.2. Enregistrement de la signature sous forme d&#8217;entier</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Depuis le navigateur, afficher la signature du certificat de <em>letsencrypt.org</em>.</p>
</li>
<li>
<p>SÃ©lectionner la signature et la copier-coller dans un Ã©diteur de texte.</p>
</li>
<li>
<p>Supprimer les caractÃ¨re surnumÃ©raires (enlever les ':' et les sauts de ligne).</p>
</li>
<li>
<p>Passer les caractÃ¨res hexadÃ©cimaux en majuscule <sup class="footnote">[<a id="_footnoteref_10" class="footnote" href="#_footnote_10" title="View footnote.">10</a>]</sup>.</p>
</li>
<li>
<p>Ajouter <em>s=</em> devant le nombre, et ajouter une premiÃ¨re ligne <em>ibase = 2 * 8</em>.</p>
</li>
<li>
<p>Enregistrer dans <strong><em>val.b</em></strong>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Voir figures 9 et 10.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-cle-1-redim.png" alt="Image signature dans navigateur">
</div>
<div class="title">Fig. 9 : Signature dans le navigateur </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-cle-2-redim.png" alt="Image signature dans Ã©diteur">
</div>
<div class="title">Fig. 10 : Fichier val.b </div>
</div>
<div class="paragraph">
<p>L&#8217;instruction <em>ibase = 2 * 8</em> ordonne Ã  bc de lire les nombres en hexadÃ©cimal.
<em>ibase = 16</em> fonctionne aussi, Ã  condition qu&#8217;ibase soit Ã©gal Ã  10 (valeur par dÃ©faut) au moment d&#8217;exÃ©cuter <em>ibase = 16</em>.
Si ibase est dÃ©jÃ  Ã©gal Ã  16 et que l&#8217;on exÃ©cute <em>ibase = 16</em>, une erreur se produit car bc lit 16 en hexadÃ©cimal (soit 22) et cette valeur est interdite.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Avec <em>bc</em> il est impÃ©ratif de passer les nombres hexadÃ©cimaux en majuscule.</p>
</li>
<li>
<p><em>bc</em> n&#8217;accepte pas les noms de variable qui contiennent des majuscules.</p>
</li>
</ol>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le navigateur affiche l&#8217;exposant de la clÃ© RSA (le nombre notÃ© <em>e</em> tout Ã  l&#8217;heure) sous forme dÃ©cimale, alors que dans le script bc nous l&#8217;entrons en hexadÃ©cimal. Pour convertir un nombre dÃ©cimal en hexadÃ©cimal, exÃ©cuter dans un terminal&#160;:</p>
</div>
<div class="exampleblock">
<div class="title">Linux</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ echo "obase=16; 65537" | bc
10001</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Windows</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre>$ echo obase=16; 65537 | bc.exe
10001</pre>
</div>
</div>
</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Passer du texte en majuscule</div>
<div class="exampleblock">
<div class="title">Linux</div>
<div class="content">
<div class="paragraph">
<p>Sous Linux, on peut utiliser la ligne de commande, par exemple (nombreuses autres solutions)&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ tr '[:lower:]' '[:upper:]' &lt; fichier_entrÃ©e &gt; fichier_sortie</pre>
</div>
</div>
<div class="paragraph">
<p>Un Ã©diteur suffisamment avancÃ© comme <em>vim</em> ou <em>emacs</em> le permet aussi.</p>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Windows</div>
<div class="content">
<div class="paragraph">
<p>Windows ne dispose pas par dÃ©faut d&#8217;outil pour passer du texte en majuscule. L&#8217;une des solutions est d&#8217;installer les utilitaires adÃ©quats avec <em>GNUWin32</em> ou bien <em>cygwin</em>.</p>
</div>
<div class="paragraph">
<p>L&#8217;Ã©diteur de texte (natif) adaptÃ© pour ce type de transformation est <strong><em>notepad++</em></strong>, disponible Ã  cette URL&#160;<a href="#8">[8]</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<em>vim</em> et <em>emacs</em> sont disponibles sous Windows.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_enregistrement_de_la_clÃ©_publique_sous_forme_d_entier">3.2.3. Enregistrement de la clÃ© publique sous forme d&#8217;entier</h4>
<div class="paragraph">
<p>Depuis le navigateur&#160;:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>SÃ©lectionner le certificat de <em>TrustID Server CA A52</em> et afficher sa clÃ© publique.</p>
</li>
<li>
<p>SÃ©lectionner la valeur de la clÃ© publique et la copier-coller dans <strong><em>val.b</em></strong>.
Il faut le faire en deux fois, une fois pour le modulo de 256 octets (variable <em>n</em>) et une fois pour l&#8217;exposant (variable <em>e</em>).</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Ne pas oublier de passer les caractÃ¨res hexadÃ©cimaux en majuscule.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-cle-3-redim.png" alt="Image clÃ© dans navigateur">
</div>
<div class="title">Fig. 11 : ClÃ© publique dans le navigateur </div>
</div>
<div class="paragraph">
<p>A l&#8217;arrivÃ©e, <strong><em>val.b</em></strong> contient trois variables, <em>s</em> (la signature du certificat), <em>n</em> et <em>e</em> (la clÃ© publique).
On a ajoutÃ© la sauvegarde et la rÃ©cupÃ©ration d'<em>ibase</em>, c&#8217;est une bonne pratique.</p>
</div>
<div class="listingblock">
<div class="title">val.b</div>
<div class="content">
<pre class="highlight"><code class="language-bc" data-lang="bc">save_ibase=ibase
ibase=2*8
s=8049A7CE9627701FC4E520876B97271A8AEF34D13A5ECA776172BD7C9053DBEF9C8504E4C85629135D934D1F9C6FB09375189812B3475D5F0797F5D32BC9B11B12BC29733DCD40E57EB97BC819F21939764A4F2A270036906BAE5FD280D68DCC16428C0FCD3D213025BCFA10A6697529ED1A168E0D2CEFCB24A9C9A64C85F0BF8942B91F2CD1E92989F73EF9F2267BAB5535C3388C10C3C1D55DBC3A50A01A77CEDED612862D83A9B1A68A08B68DC35BE0F2E23E3BD9AFD4C0BA1537CFD694A5AF5D6CF8887861A9DCB89B9DE35AD3F255C251B0ECD54C2CF693DD5732EDF33939334BDB1E64C29636E0502E57914984BDA74C7E05AC948403D2BEBE051452F8
n=9769D7999885023FE9264276E8F4733FA932442690782E78579119A05D762B49F9935A5D5ACE82F3C2D8E54C367A2B1D0DDBA6A7FE91127CED7201B78CA1C5DACC9DFE09FB57E214470FE89E918F942D8032939303F5287868BA7E0F42B4317A0514225333E4A3AD6C8FAFBE636BB2329FD917B9C9E0607C99D631E1E4A0B73FAFB232AC7E8C9CDC02EBE1BC1F149CBC91F7B2FB42F3E1202BCBBF8FF3B37063FAF7752802ABC5D4B0EDEA257F87CD371496833C40021BA09E19477FF3B0CCC52560B83512F151EB17DCFC5BA5D99BEF404CD77771E9FB458B7EF2E369B042661746903ACD463DF1B0096FDCFFEE3361CAFCC72E3CED5E0AD1BF221269804B23
e=10001
ibase=save_ibase</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_la_fonction_em_powmod_em">3.2.4. La fonction <em>powmod</em></h4>
<div class="paragraph">
<p>Les amateurs de <em>python</em> ont encore un avantage Ã  ce stade. L&#8217;Ã©quivalent de la fonction <em>powmod</em> y est disponible sous forme d&#8217;un troisiÃ¨me paramÃ¨tre (facultatif) Ã  la fonction <em>pow</em>.</p>
</div>
<div class="paragraph">
<p>Pour ceux qui utilisent <em>bc</em> comme moi, il faut Ã©crire la fonction.</p>
</div>
<div class="paragraph">
<p>La fonction <em>powmod</em> met en oeuvre l&#8217;algorithme d&#8217;exponentiation rapide, dÃ©crit Ã  cette URL&#160;<a href="#9">[9]</a>.
En fait nous sommes dans un contexte modulaire et d&#8217;aprÃ¨s WikipÃ©dia le nom exact de l&#8217;algorithme est <em>exponentiation modulaire</em>. Un article y est consacrÃ©e&#160;<a href="#10">[10]</a>.
Les deux algorithmes font appel au mÃªme principe, mais le second exploite le contexte modulaire pour que les nombres manipulÃ©s n&#8217;atteignent pas une taille dÃ©mesurÃ©e. C&#8217;est le second algorithme (<em>exponentiation modulaire</em>) dont nous avons besoin pour la suite.</p>
</div>
<div class="paragraph">
<p>Sur Internet, on peut trouver la fonction <em>powmod</em> dans de nombreux scripts <em>bc</em> Ã  tÃ©lÃ©charger. Ã noter qu&#8217;elle porte parfois d&#8217;autres noms, <em>mpower</em> par exemple.</p>
</div>
<div class="listingblock">
<div class="title">powmod.b</div>
<div class="content">
<pre class="highlight"><code class="language-bc" data-lang="bc">define powmod(a, b, c) {
	auto p, r
	p = a
	r = 1
	while (b &gt; 0) {
		if (b % 2) r = (r * p) % c
		p = (p * p) % c
		b /= 2
	}
	return r
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_calcul_de_em_m_em">3.2.5. Calcul de <em>M</em></h4>
<div class="paragraph">
<p>Nous voilÃ  prÃªts pour calculer <em>M</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Lancer la commande suivante <sup class="footnote">[<a id="_footnoteref_11" class="footnote" href="#_footnote_11" title="View footnote.">11</a>]</sup>&#160;:</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>$ BC_LINE_LENGTH=0 bc powmod.b val.b</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Dans le shell <em>bc</em>, exÃ©cuter
<sup class="footnoteref">[<a class="footnote" href="#_footnote_7" title="View footnote.">7</a>]</sup> (pour que les nombres soient affichÃ©s en hexadÃ©cimal)</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>obase=2*8</pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>Toujours dans le shell <em>bc</em>, exÃ©cuter</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre>powmod(s, e, n)</pre>
</div>
</div>
<div class="paragraph">
<p>Rappelons que c&#8217;est <em>S</em> (variable <em>s</em> dans <em>val.b</em>) qui doit Ãªtre Ã©levÃ© Ã  la puissance <em>e</em>, modulo <em>n</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-powmod-redim.png" alt="Image rÃ©sultat powmod">
</div>
<div class="title">Fig. 12 : Calcul pour vÃ©rifier la signature RSA </div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Si vous exÃ©cutez <em>obase&#160;=&#160;16</em>, vous obtiendrez le rÃ©sultat voulu (<em>obase</em> dÃ©fini Ã  <em>16 dÃ©cimal</em>) seulement si <em>ibase</em> vaut <em>10</em>.
Pour parer Ã  toute Ã©ventualitÃ©, le plus simple est d&#8217;utiliser <em>2&#160;*&#160;8</em> comme ici (ou bien <em>2&#160;^&#160;4</em>, ou quoi que ce soit qui n&#8217;utilise que des nombres Ã  un seul chiffre).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le rÃ©sultat (figure 12) avec tous ces <em>F</em> prouve avec une quasi certitude que le calcul s&#8217;est bien passÃ©.
Les <em>F</em> correspondent au 'padding' standard effectuÃ© pour une signature RSA, la valeur qui suit (Ã  partir de <strong><code>303130</code></strong>) est le hash de tbsCertificate "emballÃ©".</p>
</div>
<div class="paragraph">
<p>"EmballÃ©", c&#8217;est-Ã -dire ? La valeur est spÃ©cifiÃ©e en ASN.1 et codÃ©e en DER, et elle contient d&#8217;autres informations que le seul hash de tbsCertificate.</p>
</div>
<div class="paragraph">
<p>C&#8217;est ce que nous allons voir dans le chapitre suivant.</p>
</div>
</div>
<div class="sect3">
<h4 id="_analyse_de_em_m_em">3.2.6. Analyse de <em>M</em></h4>
<div class="paragraph">
<p>Nous allons procÃ©der en trois Ã©tapes&#160;:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Enregistrement du contenu hexadÃ©cimal</p>
</li>
<li>
<p>Conversion du contenu hexadÃ©cimal en binaire</p>
</li>
<li>
<p>Examen du contenu binaire avec la commande <em>openssl asn1parse</em></p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_1_enregistrement_du_contenu_hexadÃ©cimal">1 Enregistrement du contenu hexadÃ©cimal</h5>
<div class="paragraph">
<p>Faisons un copier-coller de <em>M</em> (en hexadÃ©cimal) Ã  partir de l&#8217;octet qui suit l&#8217;octet nul, et enregistrons le rÃ©sultat dans le fichier <strong><em>m.hex</em></strong>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-m.hex-redim.png" alt="Image m.hex">
</div>
<div class="title">Fig. 13 : m.hex </div>
</div>
<div class="listingblock">
<div class="title">Contenu de m.hex</div>
<div class="content">
<pre>3031300D0609608648016503040201050004208364DA78F1FD8DCC6812E568268BF2DAF8791BE383109745388879C496A8C3DD</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_2_conversion_du_contenu_hexadÃ©cimal_en_binaire">2 Conversion du contenu hexadÃ©cimal en binaire</h5>
<div class="paragraph">
<p>Maintenant nous allons convertir <em>m.hex</em> en binaire, puisque le contenu actuel est le <em>codage des octets en hexadÃ©cimal</em> de la signature, ce n&#8217;est pas la signature elle-mÃªme.</p>
</div>
<div class="exampleblock">
<div class="title">Linux</div>
<div class="content">
<div class="paragraph">
<p>ExÃ©cuter la commande</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ xxd -r -p m.hex &gt; m.der</pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Windows</div>
<div class="content">
<div class="paragraph">
<p>Le plus simple est d&#8217;utiliser <em>notepad++</em> et d&#8217;enregistrer le fichier transformÃ© avec le nom <em>m.der</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-notepadpp-1-redim.png" alt="Image notepad++ 1">
</div>
<div class="title">Fig. 14 : Avant la conversion hexadÃ©cimal -> binaire </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-notepadpp-2-redim.png" alt="Image notepad++ 2">
</div>
<div class="title">Fig. 15 : AprÃ¨s la conversion hexadÃ©cimal -> binaire </div>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="title">Attention</div>
</td>
<td class="content">
<div class="paragraph">
<p>Ne pas laisser un saut de ligne Ã  la fin du fichier qui s&#8217;ajouterait aux donnÃ©es binaires de la signature.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="paragraph">
<p>Le fichier <em>m.der</em> contient les octets que l&#8217;on avait dans la signature, ce que l&#8217;on peut vÃ©rifier facilement&#8230;&#8203;</p>
</div>
<div class="ulist">
<ul>
<li>
<p>&#8230;&#8203; sous Linux avec la commande <em>hd</em> (on peut aussi utiliser <em>hexdump</em> ou <em>xxd</em>).</p>
</li>
<li>
<p>&#8230;&#8203; sous Windows avec <em>notepad++</em>, en reconvertissant en hexadÃ©cimal et en vÃ©rifiant que l&#8217;on retombe sur ses pieds.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-m.der-redim.png" alt="Image m.der">
</div>
<div class="title">Fig. 16 : Contenu du fichier binaire m.der </div>
</div>
</div>
<div class="sect4">
<h5 id="_3_examen_du_contenu_der_du_fichier_m_der">3 Examen du contenu DER du fichier m.der</h5>
<div class="sidebarblock">
<div class="content">
<div class="title">openssl</div>
<div class="paragraph">
<p>Pour afficher le contenu binaire (qui se trouve Ãªtre encodÃ© en DER) nous allons utiliser l&#8217;exÃ©cutable en ligne de commande fourni avec la librairie openssl. Cet outil s&#8217;appelle <em>openssl</em>.</p>
</div>
<div class="paragraph">
<p>Par la suite nous utiliserons Ã©galement <em>dder</em> et <em>pkfile</em>, deux utilitaires crÃ©Ã©s par l&#8217;auteur de cet article pour afficher et extraire plus facilement ce type de donnÃ©es.</p>
</div>
<div class="paragraph">
<p><em>dder</em> est disponible Ã  l&#8217;URL&#160;<a href="#11">[11]</a>.</p>
</div>
<div class="paragraph">
<p><em>pkfile</em> est disponible Ã  l&#8217;URL&#160;<a href="#12">[12]</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sous Linux <em>openssl</em> est disponible par dÃ©faut.</p>
</li>
<li>
<p>Sous Windows il faut trouver un binaire <em>openssl</em> Ã  tÃ©lÃ©charger.
Le plus simple est de tÃ©lÃ©charger la version GNUWin32, disponible Ã  cette URL&#160;<a href="#13">[13]</a>.</p>
<div class="paragraph">
<p>La version proposÃ©e au tÃ©lÃ©chargement (en fÃ©vrier 2016) date de 2008. Des binaires plus rÃ©cents sont disponibles sur Internet.
Pour faire les manipulations dÃ©crites dans ce document, la version de GNUWin32 est suffisante.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ã noter que sous Windows les environnements "de taille importante" (<em>cygwin</em>, <em>perl</em>, &#8230;&#8203;) sont souvent installÃ©s avec leur librairie openssl, qui contient l&#8217;outil en ligne de commande <em>openssl</em>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>ExÃ©cuter la commande</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ openssl asn1parse -inform der -in m.der</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-m.der-openssl-redim.png" alt="Image m.der avec openssl">
</div>
<div class="title">Fig. 17 </div>
</div>
<div class="paragraph">
<p>Nous verrons dans le chapitre suivant la syntaxe ASN.1 plus en dÃ©tail.</p>
</div>
<div class="paragraph">
<p>La commande <em>openssl</em> (figure 17) nous donne deux informations&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>L&#8217;algorithme de hash est SHA-256, ce que l&#8217;on savait dÃ©jÃ  d&#8217;aprÃ¨s le contenu de <em>signatureAlgorithm</em> (deuxiÃ¨me partie de la structure en trois parties du certificat).</p>
</li>
<li>
<p>Nous voyons la valeur du hash (le bloc <strong><code>prim: OCTET STRING</code></strong>) sous forme hexadÃ©cimale. Sa longueur correspond bien au SHA-256 (256 bits de longueur soit 32 octets).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Nous savons dÃ©sormais que la signature SHA-256 de la valeur tbsCertificate du certificat de <em>letsencrypt.org</em> devrait Ãªtre&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>8364DA78F1FD8DCC6812E568268BF2DAF8791BE383109745388879C496A8C3DD</pre>
</div>
</div>
<div class="paragraph">
<p>C&#8217;est ce que nous allons vÃ©rifier en calculant maintenant <em>M'</em>.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_calcul_de_em_m_em_2">3.2.7. Calcul de <em>M'</em></h4>
<div class="paragraph">
<p>Nous allons calculer <em>M'</em> en deux Ã©tapes&#160;:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Extraction de tbsCertificate du certificat <em>letsencrypt.org</em>.</p>
</li>
<li>
<p>Calcul du hash SHA-256 de tbsCertificate.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Mais avant d&#8217;extraire tbsCertificate, nous devons comprendre comment le certificat est structurÃ© et codÃ©.</p>
</div>
<div class="sect4">
<h5 id="_asn_1_et_der">ASN.1 et DER</h5>
<div class="paragraph">
<p>Au dÃ©but de ce document, nous avons observÃ© que la section 4.1 de la RFC 5280, qui dÃ©finit la structure des certificats x509 v3, contient cette dÃ©finition&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Certificate  ::=  SEQUENCE  {
	tbsCertificate       TBSCertificate,
	signatureAlgorithm   AlgorithmIdentifier,
	signatureValue       BIT STRING  }</pre>
</div>
</div>
<div class="paragraph">
<p>Un certificat x509 est dÃ©fini selon la syntaxe ASN.1.
L&#8217;encodage peut Ãªtre BER
<sup class="footnote">[<a id="_footnoteref_12" class="footnote" href="#_footnote_12" title="View footnote.">12</a>]</sup>
, CER
<sup class="footnote">[<a id="_footnoteref_13" class="footnote" href="#_footnote_13" title="View footnote.">13</a>]</sup>
ou DER
<sup class="footnote">[<a id="_footnoteref_14" class="footnote" href="#_footnote_14" title="View footnote.">14</a>]</sup>
.</p>
</div>
<div class="paragraph">
<p>Ces trois standards sont trÃ¨s proches, l&#8217;intÃ©rÃªt de DER Ã©tant son unicitÃ©&#160;: une structure de donnÃ©es spÃ©cifiÃ©e en ASN.1 ne peut Ãªtre encodÃ©e en DER que d&#8217;une maniÃ¨re, et une seule. BER et CER permettent certaines variations dans la maniÃ¨re d&#8217;encoder.</p>
</div>
<div class="paragraph">
<p>Pour ne pas alourdir la rÃ©daction, nous parlerons toujours d&#8217;encodage DER ou simplement DER, mÃªme lorsque les donnÃ©es manipulÃ©es pourraient ne pas Ãªtre DER
<sup class="footnote">[<a id="_footnoteref_15" class="footnote" href="#_footnote_15" title="View footnote.">15</a>]</sup>
.</p>
</div>
<div class="paragraph">
<p>ASN.1 structure chaque valeur (<em>data value</em> dans le document X.690) selon la typologie <strong>T</strong>&#160;-&#160;<strong>L</strong>&#160;-&#160;<strong>V</strong> ou <strong>T</strong>ag&#160;-&#160;<strong>L</strong>ength&#160;-&#160;<strong>V</strong>alue.
La forme "longueur indÃ©finie" apporte un quatriÃ¨me Ã©lÃ©ment, "end-of-contents" (marqueur de fin de valeur), que nous ignorerons car DER ne permet pas cette forme.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">[<strong>T</strong>]ag</dt>
<dd>
<p>DÃ©finit toutes les caractÃ©ristiques de la valeur, notamment son <em>type</em>, par exemple une date (<code>UTCTime</code>), une sÃ©quence (<code>SEQUENCE</code> ou <code>SEQUENCE&#160;OF</code>), un entier (<code>INTEGER</code>), et bien d&#8217;autres. Il indique Ã©galement si l&#8217;encodage de la valeur est <em>primitive</em> ou <em>contructed</em>.</p>
<div class="dlist">
<dl>
<dt class="hdlist1">Encodage <em>primitive</em></dt>
<dd>
<p>La donnÃ©e ne contient pas de sous-structure</p>
</dd>
<dt class="hdlist1">Encodage <em>constructed</em></dt>
<dd>
<p>La donnÃ©e est elle-mÃªme une structure qui suit la typologie <strong>T</strong>-<strong>L</strong>-<strong>V</strong>, et ici, cette structure est elle-mÃªme dÃ©finie en ASN.1&#160;<sup class="footnote">[<a id="_footnoteref_16" class="footnote" href="#_footnote_16" title="View footnote.">16</a>]</sup>.</p>
</dd>
<dt class="hdlist1">Structure hiÃ©rarchique</dt>
<dd>
<p>La diffÃ©rence <em>primitive</em> - <em>constructed</em> est Ã  la base de la structure hiÃ©rarchique d&#8217;une spÃ©cification ASN.1, les Ã©lÃ©ments <em>constructed</em> Ã©tant les branches, les Ã©lÃ©ments <em>primitive</em> Ã©tant les feuilles.</p>
<div class="paragraph">
<p>Dans la dÃ©finition d&#8217;un <em>Certificate</em> ci-dessus, le type <code>SEQUENCE</code> est, par dÃ©finition du type <code>SEQUENCE</code> en ASN.1, <em>constructed</em>. Cela signifie que la valeur <code>SEQUENCE</code> est elle-mÃªme une structure ASN.1, ce qu&#8217;on peut voir dans la liste des trois composants d&#8217;un certificat dÃ©finie entre accolades.</p>
</div>
</dd>
</dl>
</div>
</dd>
<dt class="hdlist1">[<strong>L</strong>]ength</dt>
<dd>
<p>Donne la longueur de la valeur en octets.</p>
</dd>
<dt class="hdlist1">[<strong>V</strong>]alue</dt>
<dd>
<p>Est la donnÃ©e elle-mÃªme. Dans ce document nous employons le terme <em>valeur</em> (dans le document X.690 le terme est <em>data value</em>).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Affichons le contenu DER avec l&#8217;utilitaire en ligne de commande <em>dder</em> en exÃ©cutant la commande suivante&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ dder -width 8 -recursive "|  " m.der</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-dder-redim.png" alt="Image lecture m.der avec dder">
</div>
<div class="title">Fig. 18 </div>
</div>
<div class="paragraph">
<p>La copie d&#8217;Ã©cran de la figure 18 a Ã©tÃ© faite sous Windows pour changer un peu.</p>
</div>
<div class="paragraph">
<p>La description de la valeur indique <em>-cons</em> ou <em>-prim</em>, pour <em>constructed</em> ou <em>primitive</em>.
Chaque fois que le tag indique une valeur <em>constructed</em> (ici, il s&#8217;agit Ã  deux reprises du type <code>SEQUENCE</code>, qui est obligatoirement <em>constructed</em>), on descend d&#8217;un niveau dans la structure hiÃ©rarchique, que l&#8217;on a fait ressortir ici avec l&#8217;option <em>-recursive "|  "</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_extraction_de_tbscertificate_du_certificat_em_letsencrypt_org_em">Extraction de tbsCertificate du certificat <em>letsencrypt.org</em></h5>

</div>
<div class="sect4">
<h5 id="_Ãtape_1_de_l_extraction">Ãtape 1 de l&#8217;extraction</h5>
<div class="paragraph">
<p>CommenÃ§ons par enregistrer le certificat depuis le navigateur, dans le fichier <em>letsencryptorg.der</em>.</p>
</div>
<div class="exampleblock">
<div class="title">Firefox</div>
<div class="content">
<div class="paragraph">
<p>Afficher le certificat comme vu prÃ©cÃ©demment, puis afficher l&#8217;onglet <em>DÃ©tails</em> et cliquer sur le bouton <em>Exporter</em>.
Ensuite sÃ©lectionner <em>Certificat X.509 (DER)</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-certsave-ff-redim.png" alt="Enregistrement certificat depuis Firefox">
</div>
<div class="title">Fig. 19 </div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Internet Explorer et Chrome</div>
<div class="content">
<div class="paragraph">
<p>Afficher le certificat, puis cliquer sur le bouton <em>Copier dans un fichier&#8230;&#8203;</em>.
Ensuite sÃ©lectionner <em>X.509 binaire encodÃ© DER</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-certsave-ie-redim.png" alt="Enregistrement certificat depuis IE et Chrome">
</div>
<div class="title">Fig. 20 </div>
</div>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">PEM versus DER</div>
<div class="paragraph">
<p>Avec les certificats x509, l&#8217;encodage PEM est une surcouche de DER qui consiste Ã &#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Encoder le contenu binaire (aprÃ¨s chiffrement Ã©ventuel) en BASE64</p>
</li>
<li>
<p>Ajouter au dÃ©but et Ã  la fin un texte standardisÃ© qui dÃ©finit et dÃ©limite la nature du contenu, ainsi que les informations de chiffrement s&#8217;il y a lieu</p>
<div class="ulist">
<ul>
<li>
<p>La ligne ajoutÃ©e au dÃ©but commence par <strong><code>-----BEGIN</code></strong></p>
</li>
<li>
<p>La ligne ajoutÃ©e Ã  la fin commence par <strong><code>-----END</code></strong></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Si vous avez enregistrÃ© le certificat avec un encodage PEM, vous pouvez le convertir en DER avec <em>openssl</em>. Exemple pour <em>letsencrypt.cer</em> (PEM) que l&#8217;on convertit en <em>letsencrypt.der</em> (DER)&#160; - comme on peut voir, l&#8217;encodage par dÃ©faut avec <em>openssl</em> est PEM.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ openssl x509 -in letsencryptorg.cer -outform der -out letsencryptorg.der</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-pem-redim.png" alt="Exemple encodage PEM">
</div>
<div class="title">Fig. 21 </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-convpemder-redim.png" alt="Exemple conversion PEM vers DER">
</div>
<div class="title">Fig. 22 </div>
</div>
<div class="paragraph">
<p>Vous pouvez faire cette conversion "Ã  la main" en enlevant la premiÃ¨re et la derniÃ¨re ligne et en faisant une conversion BASE64&#160;&#8594;&#160;binaire avec des outils comme <em>base64</em> (Linux) ou <em>notepad++</em> (Windows).</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_Ãtape_2_de_l_extraction">Ãtape 2 de l&#8217;extraction</h5>
<div class="paragraph">
<p>Nous disposons maintenant d&#8217;un certificat enregistrÃ© en binaire (encodage DER) dans le fichier <em>letsencryptorg.der</em>, dont nous allons Ã  prÃ©sent extraire la partie tbsCertificate.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Les outils <em>dder</em> et <em>pkfile</em> (<em>pkfile</em> est prÃ©sentÃ© plus loin) peuvent lire indiffÃ©remment des fichiers codÃ©s en PEM ou en DER. Si le fichier est PEM, il est dÃ©codÃ© Ã  la volÃ©e.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Il y a deux solutions pour ce faire</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ã la main</p>
</li>
<li>
<p>Ã l&#8217;aide de l&#8217;utilitaire <em>pkfile</em>. <em>pkfile</em> est disponible Ã  cette URL&#160;<a href="#12">[12]</a>.</p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">Extraction de tbsCertificate&#160;: 1Ã¨re mÃ©thode (Ã  la main)</div>
<p>Un Ã©diteur de fichier binaire ferait l&#8217;affaire, mais la manipulation est plus claire si l&#8217;on affiche le contenu hexadÃ©cimal avec <em>dder</em>.</p>
</div>
<div class="paragraph">
<p>ExÃ©cuter la commande</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ dder -recursive "|  " -hex letsencryptorg.der &gt; d</pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Encodage des fichiers affichÃ©s par dder</div>
<div class="paragraph">
<p><em>dder</em> lit indiffÃ©remment des fichiers PEM et DER. Si le fichier est PEM il dÃ©code (et dÃ©crypte si nÃ©cessaire) les donnÃ©es en mÃ©moire avant d&#8217;afficher le contenu DER.</p>
</div>
<div class="paragraph">
<p>Donc la commande aurait pu Ãªtre (avec le fichier <em>letsencryptorg.cer</em> encodÃ© en PEM)&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ dder -recursive "|  " -hex letsencryptorg.cer &gt; d</pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Ouvrir le fichier <em>d</em> dans un Ã©diteur de texte.
Comme on a affichÃ© le contenu avec un dÃ©calage Ã  chaque niveau hiÃ©rarchique (option <em>-recursive "|  "</em>), la structure en trois parties des certificats x509 ressort bien.</p>
</div>
<div class="paragraph">
<p>Supprimer les deux premiÃ¨res lignes et un certain nombre de lignes Ã  la fin pour que seul demeure le contenu de tbsCertificate.
Ci-dessous, le texte Ã  conserver est le texte sÃ©lectionnÃ© (les lignes du milieu ont Ã©tÃ© supprimÃ©es pour condenser l&#8217;image).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-extracttbs-alt1-1.png" alt="Image extraction tbsCertificate alternative 1 - 1">
</div>
<div class="title">Fig. 23 </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-extracttbs-alt1-2-redim.png" alt="Image extraction tbsCertificate alternative 1 - 2">
</div>
<div class="title">Fig. 24 </div>
</div>
<div class="paragraph">
<p>Ensuite&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Supprimer les "|" en dÃ©but de ligne</p>
</li>
<li>
<p>Supprimer l&#8217;offset (numÃ©ro sur six caractÃ¨res)</p>
</li>
<li>
<p>Supprimer le texte aprÃ¨s les codes hexadÃ©cimaux (une fois supprimÃ© les "|" et l&#8217;offset en dÃ©but de ligne, ce sont tous les caractÃ¨res au-delÃ  de la 55e position qu&#8217;il faut supprimer).</p>
</li>
<li>
<p>Supprimer tous les espaces</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-extracttbs-alt1-3-redim.png" alt="Image extraction tbsCertificate alternative 1 - 3">
</div>
<div class="title">Fig. 25 </div>
</div>
<div class="paragraph">
<p>On retrouve (figure 25) une sous-partie du fichier <em>letsencryptorg.der</em>, codÃ©e en hexadÃ©cimal, qui commence par <strong><code>308205ea</code></strong> et se termine par <strong><code>2e6f7267</code></strong>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph">
<p>Cette manipulation peut Ãªtre faite avec un programme d&#8217;Ã©dition de fichier binaire, en ne gardant que les donnÃ©es Ã  partir de l&#8217;offset 4, d&#8217;une longueur de 1518 octets.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Il faut ensuite convertir le contenu "codÃ© hexadÃ©cimal" en binaire comme cela a Ã©tÃ© vu prÃ©cÃ©demment (commande <em>xxd -r -p</em> sous Linux, avec <em>notepad++</em> sous Windows).</p>
</div>
<div class="paragraph">
<p>Au final on obtient le fichier <em>tbs.der</em> comme montrÃ© sur la figure 26.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-extracttbs-alt1-4-redim.png" alt="Image extraction tbsCertificate alternative 1 - 4">
</div>
<div class="title">Fig. 26 </div>
</div>
<div class="paragraph">
<div class="title">Extraction de tbsCertificate&#160;: 2Ã¨me mÃ©thode (Ã  l&#8217;aide de <em>pkfile</em>)</div>
<p>ExÃ©cuter la commande</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ pkfile letsencryptorg.der -l 2</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-extracttbs-alt2-1-redim.png" alt="Image extraction tbsCertificate alternative 2 - 1">
</div>
<div class="title">Fig. 27 </div>
</div>
<div class="paragraph">
<p>Le rÃ©sultat visible sur la figure 27 nous montre que le tbsCertificate correspond Ã  la valeur <code>SEQUENCE</code> de 1518 octets (4 octets d&#8217;en-tÃªte, 1514 octets de donnÃ©es). <em>pkfile</em> donne Ã  cette valeur les coordonnÃ©es 1.1.</p>
</div>
<div class="paragraph">
<p>Nous enregistrons cette valeur en binaire dans le fichier <em>tbs2.der</em> en exÃ©cutant la commande</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ pkfile letsencryptorg.der -n 1.1 -x -o tbs2.der</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-extracttbs-alt2-2.png" alt="Image extraction tbsCertificate alternative 2 - 2">
</div>
<div class="title">Fig. 28 </div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Encodage des fichiers analysÃ©s par pkfile</div>
<div class="paragraph">
<p><em>pkfile</em> lit indiffÃ©remment des fichiers PEM et DER. Si le fichier est PEM il dÃ©code (et dÃ©crypte si nÃ©cessaire) les donnÃ©es en mÃ©moire avant de traiter le contenu DER.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_calcul_du_hash_de_tbscertificate">Calcul du hash de tbsCertificate</h5>
<div class="exampleblock">
<div class="title">Linux</div>
<div class="content">
<div class="paragraph">
<p>Le calcul des diffÃ©rents algorithmes de hash est disponible en ligne de commande. Pour SHA-256 le programme est <em>sha256sum</em>.</p>
</div>
<div class="paragraph">
<p>ExÃ©cuter</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ sha256sum tbs.der</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-calchash-1-redim.png" alt="Calcul hash Linux">
</div>
<div class="title">Fig. 29 </div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Windows</div>
<div class="content">
<div class="paragraph">
<p>Lels outils de calcul de hash ne sont pas disponibles par dÃ©faut. Voici quelques solutions (d&#8217;autres existent)&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Utiliser <em>pkfile</em>, qui permet de calculer diffÃ©rents hash<sup class="footnote">[<a id="_footnoteref_17" class="footnote" href="#_footnote_17" title="View footnote.">17</a>]</sup>
.</p>
</li>
<li>
<p>Installer les outils <em>GNUWin32</em>, disponibles Ã  cette URL&#160;<a href="#13">[13]</a>.</p>
</li>
<li>
<p>7-ZIP ajoute des menus contextuels dans l&#8217;explorateur pour calculer diffÃ©rents hashs, dont SHA-256. 7-ZIP est disponible Ã  cette URL&#160;<a href="#14">[14]</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Exemple avec <em>pkfile</em>, exÃ©cuter</p>
</div>
<div class="listingblock">
<div class="content">
<pre>$ pkfile --sha256 tbs.der</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-calchash-2.png" alt="Calcul hash Windows, 2">
</div>
<div class="title">Fig. 30 </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-calchash-3.png" alt="Calcul hash Windows, 3">
</div>
<div class="title">Fig. 31 </div>
</div>
</div>
</div>
<div class="paragraph">
<p>Les captures d&#8217;Ã©cran montrent Ã©galement le calcul sur le fichier <em>tbs2.der</em> (crÃ©Ã© avec <em>pkfile</em>), qui est ben identique Ã  <em>tbs.der</em>, ce qui confirme au passage l&#8217;Ã©quivalence des deux mÃ©thodes pour extraire tbsCertificate.</p>
</div>
<div class="paragraph">
<p><strong>Le hash trouvÃ© (<em>M'</em>) concorde avec la signature (<em>M</em>), ce qui valide la signature du certificat <em>letsencrypt.org</em></strong></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_conclusion">3.3. Conclusion</h3>
<div class="paragraph">
<p>Nous arrivons au terme des manipulations Ã  effectuer pour vÃ©rifier la signature RSA d&#8217;un certificat x509. Les calculs Ã©taient Ã©lÃ©mentaires, mais cela nous a permis de voir&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Les diffÃ©rents formats et encodages et les outils pour passer de l&#8217;un Ã  l&#8217;autre</p>
<div class="ulist">
<ul>
<li>
<p>PEM versus DER</p>
</li>
<li>
<p>BASE64 versus binaire</p>
</li>
<li>
<p>HexadÃ©cimal versus binaire</p>
</li>
<li>
<p>ASN.1</p>
</li>
<li>
<p>La structure de certificat x509</p>
</li>
</ul>
</div>
</li>
<li>
<p>Les solutions pour calculer sur des entiers de grande taille</p>
<div class="ulist">
<ul>
<li>
<p><em>python</em> (Ã©voquÃ© ici mais non dÃ©taillÃ©) et <em>bc</em></p>
</li>
<li>
<p>Les transformations Ã©ventuelles et prÃ©cautions Ã  prendre pour calculer en saisie et affichage hexadÃ©cimal</p>
</li>
<li>
<p>La crÃ©ation de la fonction <em>powmod</em> dans <em>bc</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Outils divers</p>
<div class="ulist">
<ul>
<li>
<p>Calcul du hash d&#8217;un fichier</p>
</li>
<li>
<p>Extraction d&#8217;une valeur (c&#8217;est-Ã -dire, d&#8217;une sous-partie) d&#8217;un fichier encodÃ© en DER</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>La <em>signature</em> a Ã©tÃ© vÃ©rifiÃ©e mais le certificat lui-mÃªme n&#8217;a pas Ã©tÃ© validÃ© en totalitÃ©. Il y a deux raisons Ã  cela.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Une fois un certificat vÃ©rifiÃ©, il faut vÃ©rifier son parent dans la hiÃ©rarchie (le certificat qui l&#8217;a signÃ©), et ainsi de suite, jusqu&#8217;Ã  vÃ©rifier un certificat connu dans la base des certificats du navigateur (les certificats <em>racine</em>).</p>
</li>
<li>
<p>Le navigateur vÃ©rifie si les certificats rencontrÃ©s ont Ã©tÃ© rÃ©voquÃ©s Ã  l&#8217;aide des Listes de RÃ©vocation des Certificats ou <em>CRL</em> (<em>Certificate Revocation List</em>).</p>
</li>
</ol>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_vÃ©rification_de_signature_ecdsa">4. VÃ©rification de signature ECDSA</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_cryptographie_Ã _courbes_elliptiques">4.1. Cryptographie Ã  courbes elliptiques</h3>
<div class="paragraph">
<p>Ce document se concentre sur les problÃ©matiques de calcul effectif et de formats de fichiers.
Nous n&#8217;allons pas expliquer ici toute la cryptographie Ã  base de courbes elliptiques, nous allons simplement en rÃ©sumer les grandes lignes, donner les formules applicables et quelques dÃ©finitions.</p>
</div>
<div class="sect3">
<h4 id="_les_deux_familles_de_courbes_elliptiques">4.1.1. Les deux familles de courbes elliptiques</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">Les courbes sur <em>F<sub>2<sup>m</sup></sub></em> (<em>binary field</em>)</dt>
<dd>
<p>La notation <em>F<sub>2<sup>m</sup></sub></em> est un raccourci. On a <em>F<sub>2<sup>m</sup></sub> = F<sub>2</sub>[x]/(p(x))</em> oÃ¹ <em>p(x)</em> est un polynÃ´me irrÃ©ductible de degrÃ© <em>m</em> (source&#160;: <a href="#15">[15]</a>). Les "nombres" manipulÃ©s sont des polynÃ´mes sur <em>F<sub>2</sub></em> et les opÃ©rations sont faites modulo <em>p(x)</em>. L&#8217;Ã©quation de la courbe (source&#160;: <a href="#16">[16]</a>) est</p>
<div class="paragraph">
<p><em>y<sup>2</sup> + xy = x<sup>3</sup> + ax<sup>2</sup> + b</em></p>
</div>
<div class="paragraph">
<p>Les opÃ©rations sur <em>F<sub>2<sup>m</sup></sub></em> portent sur des polynÃ´mes et leur arithmÃ©tique est diffÃ©rente de l&#8217;arithmÃ©tique usuelle sur les nombres entiers. Par exemple quel que soit <em>A</em> de <em>F<sub>2<sup>m</sup></sub></em>, on a <em>A&#160;+&#160;A&#160;=&#160;0</em> (soit <em>A&#160;=&#160;-A</em> pour tout <em>A</em>).</p>
</div>
</dd>
<dt class="hdlist1">Les courbes sur <em>F<sub>p</sub></em> (<em>prime field</em>)</dt>
<dd>
<p><em>p</em> est un nombre premier. On a <em>F<sub>p</sub> = Z/pZ</em> (source&#160;: <a href="#17">[17]</a>). Les opÃ©rations sont faites modulo <em>p</em>. L&#8217;Ã©quation de la courbe est (source&#160;: <a href="#16">[16]</a>)</p>
<div class="paragraph">
<p><em>y<sup>2</sup> = x<sup>3</sup> + ax + b</em></p>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_les_paramÃ¨tres_de_domaine">4.1.2. Les paramÃ¨tres de domaine</h4>
<div class="paragraph">
<p>Ces paramÃ¨tres dÃ©finissent les caractÃ©ristiques de la courbe. Une clÃ© est dÃ©finie pour une courbe et une seule, la courbe Ã©tant entiÃ¨rement dÃ©terminÃ©e par ses paramÃ¨tres de domaine. On parle aussi de paramÃ¨tres de la courbe.</p>
</div>
<div class="paragraph">
<p>Source&#160;: <a href="#16">[16]</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Sur <em>F<sub>2<sup>m</sup></sub></em>, les paramÃ¨tres sont (<em>m</em>, <em>f(x)</em>, <em>a</em>, <em>b</em>, <em>G</em>, <em>n</em>, <em>h</em>)</p>
<div class="ulist">
<ul>
<li>
<p><em>m</em>, entier qui dÃ©finit <em>F<sub>2<sup>m</sup></sub></em>.</p>
</li>
<li>
<p><em>f(x)</em>, polynÃ´me irrÃ©ductible de degrÃ© <em>m</em>.</p>
</li>
<li>
<p><em>a</em> et <em>b</em>, les paramÃ¨tres de l&#8217;Ã©quation <em>y<sup>2</sup> + xy = x<sup>3</sup> + ax<sup>2</sup> + b</em>.</p>
</li>
<li>
<p><em>G</em>, le gÃ©nÃ©rateur d&#8217;un sous-groupe du groupe <em>E(F<sub>2<sup>m</sup></sub>)</em>.</p>
</li>
<li>
<p><em>n</em> est l&#8217;ordre du groupe gÃ©nÃ©rÃ© par <em>G</em>.</p>
</li>
<li>
<p><em>h</em> est le cofacteur, c&#8217;est le nombre d&#8217;Ã©lÃ©ments de <em>E(F<sub>2<sup>m</sup></sub>)</em> divisÃ© par <em>n</em>.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Sur <em>F<sub>p</sub></em>, les paramÃ¨tres sont (<em>p</em>, <em>a</em>, <em>b</em>, <em>G</em>, <em>n</em>, <em>h</em>)</p>
<div class="ulist">
<ul>
<li>
<p><em>p</em>, nombre premier.</p>
</li>
<li>
<p><em>a</em> et <em>b</em>, les paramÃ¨tres de l&#8217;Ã©quation <em>y<sup>2</sup> (mod p) = x<sup>3</sup> + ax + b (mod p)</em>.</p>
</li>
<li>
<p><em>G</em>, le gÃ©nÃ©rateur d&#8217;un sous-groupe du groupe <em>E(F<sub>p</sub>)</em>.</p>
</li>
<li>
<p><em>n</em> est l&#8217;ordre du groupe gÃ©nÃ©rÃ© par <em>G</em>.</p>
</li>
<li>
<p><em>h</em> est le cofacteur, c&#8217;est le nombre d&#8217;Ã©lÃ©ments de <em>E(F<sub>p</sub>)</em> divisÃ© par <em>n</em>.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<div class="title">Les courbes nommÃ©es</div>
<p>Toute information pratique sur les courbes elliptiques (clÃ© privÃ©e ou publique, signature&#8230;&#8203;) n&#8217;est exploitable qu&#8217;avec les paramÃ¨tres de domaine de la courbe elliptique utilisÃ©e.
Les paramÃ¨tres de domaine peuvent Ãªtre donnÃ©s de deux maniÃ¨res&#160;: tels quels (les diffÃ©rents Ã©lÃ©ments vus prÃ©cÃ©demment et qui dÃ©finissent une courbe, tels que <em>a</em>, <em>b</em>, <em>G</em>, etc.), ou bien sous la forme d&#8217;une <em>courbe nommÃ©e</em>.</p>
</div>
<div class="paragraph">
<p><em>openssl</em> peut lister les courbes nommÃ©es&#160;:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ openssl ecparam -list_curves
  secp112r1 : SECG/WTLS curve over a 112 bit prime field
  secp112r2 : SECG curve over a 112 bit prime field
  [...]
  brainpoolP512r1: RFC 5639 curve over a 512 bit prime field
  brainpoolP512t1: RFC 5639 curve over a 512 bit prime field</pre>
</div>
</div>
<div class="paragraph">
<p>La commande suivante permet d&#8217;afficher les dÃ©tails d&#8217;une courbe, exemple avec <em>secp256r1</em>&#160;:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ openssl ecparam -name secp256r1 -noout -text
using curve name prime256v1 instead of secp256r1
ASN1 OID: prime256v1
NIST CURVE: P-256</pre>
</div>
</div>
<div class="paragraph">
<p><em>openssl</em> nous avertit que <em>secp256r1</em> (dÃ©finition "SECG"&#160;: <a href="#18">[18]</a>) est en fait la courbe <em>NIST P-256</em> (dÃ©finie ici <a href="#19">[19]</a>), qui porte le nom <em>prime256v1</em> dans le standard <em>X9.62</em>.</p>
</div>
<div class="paragraph">
<p>Tout Ã§a pour dire quoi&#160;? Rien, Ã  part que l&#8217;on peut se fÃ©liciter de vivre Ã  l&#8217;heure d&#8217;Internet pour s&#8217;y retrouver dans la jungle des documents de normalisation.</p>
</div>
<div class="paragraph">
<p>Et les paramÃ¨tres de domaine&#160;? Il faut demander Ã  <em>openssl</em> d&#8217;afficher les paramÃ¨tres de la courbe sous forme explicite&#160;:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ openssl ecparam -name secp256r1 -noout -text -param_enc explicit
using curve name prime256v1 instead of secp256r1
Field Type: prime-field
Prime:
    00:ff:ff:ff:ff:00:00:00:01:00:00:00:00:00:00:
    00:00:00:00:00:00:ff:ff:ff:ff:ff:ff:ff:ff:ff:
    ff:ff:ff
A:
    00:ff:ff:ff:ff:00:00:00:01:00:00:00:00:00:00:
    00:00:00:00:00:00:ff:ff:ff:ff:ff:ff:ff:ff:ff:
    ff:ff:fc
B:
    5a:c6:35:d8:aa:3a:93:e7:b3:eb:bd:55:76:98:86:
    bc:65:1d:06:b0:cc:53:b0:f6:3b:ce:3c:3e:27:d2:
    60:4b
Generator (uncompressed):
    04:6b:17:d1:f2:e1:2c:42:47:f8:bc:e6:e5:63:a4:
    40:f2:77:03:7d:81:2d:eb:33:a0:f4:a1:39:45:d8:
    98:c2:96:4f:e3:42:e2:fe:1a:7f:9b:8e:e7:eb:4a:
    7c:0f:9e:16:2b:ce:33:57:6b:31:5e:ce:cb:b6:40:
    68:37:bf:51:f5
Order:
    00:ff:ff:ff:ff:00:00:00:00:ff:ff:ff:ff:ff:ff:
    ff:ff:bc:e6:fa:ad:a7:17:9e:84:f3:b9:ca:c2:fc:
    63:25:51
Cofactor:  1 (0x1)
Seed:
    c4:9d:36:08:86:e7:04:93:6a:66:78:e1:13:9d:26:
    b7:81:9f:7e:90</pre>
</div>
</div>
<div class="paragraph">
<p>Tous ces paramÃ¨tres ont Ã©tÃ© vus plus haut, sauf <em>Seed</em>. Qu&#8217;en est-il&#160;?</p>
</div>
<div class="paragraph">
<p><em>Seed</em> est un nombre arbitraire Ã  partir duquel les autres paramÃ¨tres de la courbe ont Ã©tÃ© dÃ©terminÃ©s, de maniÃ¨re vÃ©rifiable par n&#8217;importe qui, selon une spÃ©cification <em>X9.62</em>.
Cela garantit qu&#8217;ils n&#8217;ont pas Ã©tÃ© choisis en raison de propriÃ©tÃ©s cachÃ©es qui permettraient Ã  leur inventeur de casser la protection facilement.
<em>Seed</em> est Ã  l&#8217;origine des paramÃ¨tres de la courbe mais il n&#8217;en fait pas partie.
Le calcul des paramÃ¨tres d&#8217;aprÃ¨s <em>Seed</em> utilise une fonction de hachage Ã  sens unique, ce qui garantit que le choix ne s&#8217;est pas fait dans l&#8217;autre sens (dÃ©termination de paramÃ¨tres ad hoc puis du <em>Seed</em> correspondant).</p>
</div>
<div class="paragraph">
<div class="title">Le x509</div>
<p>La RFC 5480 (<a href="#20">[20]</a>) interdit expressÃ©ment l&#8217;usage de paramÃ¨tres explicites dans le standard x509, seules les courbes nommÃ©es peuvent y Ãªtre utilisÃ©es.</p>
</div>
<div class="paragraph">
<p>Nous allons maintenant nous intÃ©resser aux courbes sur les corps premiers (<em>F<sub>p</sub></em>).
Les courbes binaires fonctionnent selon les mÃªmes principes mais les "nombres" manipulÃ©s sont des polynÃ´mes sur <em>F<sub>2</sub></em>, et si l&#8217;on souhaite y mener des calculs avec <em>bc</em> ou <em>python</em>, cela nÃ©cessite de coder spÃ©cifiquement leur arithmÃ©tique. Dans ce document nous ferons des calculs sur <em>F<sub>p</sub></em> uniquement.</p>
</div>
</div>
<div class="sect3">
<h4 id="_l_arithmÃ©tique_des_courbes_sur_em_f_sub_p_sub_em">4.1.3. L&#8217;arithmÃ©tique des courbes sur <em>F<sub>p</sub></em></h4>
<div class="paragraph">
<p>Les calculs sont faits modulo <em>p</em> et nous ne le prÃ©ciserons plus par la suite&#160;<sup class="footnote">[<a id="_footnoteref_18" class="footnote" href="#_footnote_18" title="View footnote.">18</a>]</sup>.</p>
</div>
<div class="paragraph">
<div class="title">ClÃ©s privÃ©e et publique</div>
<p>La construction d&#8217;une paire de clÃ©s privÃ©e et publique consiste Ã </p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Choisir un entier <em>k</em> infÃ©rieur Ã  <em>n</em></p>
</li>
<li>
<p>Calculer <em>Q = kG</em> oÃ¹ <em>G</em> est l&#8217;un des paramÃ¨tres de domaine de la courbe (voir ci-aprÃ¨s la multiplication d&#8217;un point par un scalaire)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Le point <em>Q</em> est la clÃ© publique, l&#8217;entier <em>k</em> est la clÃ© privÃ©e<sup class="footnote">[<a id="_footnoteref_19" class="footnote" href="#_footnote_19" title="View footnote.">19</a>]</sup>.
Ainsi contrairement au RSA oÃ¹ la clÃ© privÃ©e et publique ont mÃªme nature (ce sont deux entiers), ici la clÃ© publique est un point tandis que la clÃ© privÃ©e est un entier.</p>
</div>
<div class="paragraph">
<div class="title">Addition de deux points distincts (et non alignÃ©s verticalement)</div>
<p>La signification de l&#8217;addition de deux points est gÃ©omÃ©trique et on peut le voir ici&#160;<a href="#21">[21]</a>.</p>
</div>
<div class="paragraph">
<p>Les formules qui en dÃ©coulent sont les suivantes, pour <em>R&#160;=&#160;P&#160;+&#160;Q</em> de coordonnÃ©es (<em>r<sub>x</sub></em>, <em>r<sub>y</sub></em>), (<em>p<sub>x</sub></em>, <em>p<sub>y</sub></em>) et (<em>q<sub>x</sub></em>, <em>q<sub>y</sub></em>) respectivement, <em>P</em> Ã©tant diffÃ©rent de Q et non alignÃ© verticalement avec <em>Q</em>&#160;:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-point-add.png" alt="Addition de deux points">
</div>
</div>
<div class="paragraph">
<div class="title">Addition d&#8217;un point avec lui-mÃªme</div>
<p>Pour <em>P&#160;=&#160;Q</em>, le calcul de <em>R&#160;=&#160;P&#160;+&#160;P&#160;=&#160;2P</em> est (en reprenant les notations prÃ©cÃ©dentes)&#160;:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-point-dbl.png" alt="Addition d'un point avec lui-mÃªme">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Le symbole de fraction n&#8217;est pas la division euclidienne mais la multiplication par l&#8217;inverse modulo <em>p</em>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Multiplication d&#8217;un point par un entier naturel</div>
<p>Avec les formules qui prÃ©cÃ¨dent, on sait calculer <em>P&#160;&#43;&#160;P&#160;=&#160;2P</em>, <em>P&#160;&#43;&#160;2P&#160;=&#160;3P</em>, et ainsi de suite.
On sait donc calculer <em>kP</em>, <em>k</em> entier.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Addition de deux points alignÃ©s verticalement</div>
<div class="paragraph">
<p>Si <em>P</em> et <em>Q</em> sont alignÃ©s verticalement ils sont opposÃ©s (cela dÃ©coule du terme <em>y<sup>2</sup></em> de l&#8217;Ã©quation), on a donc <em>P&#160;=&#160;-Q</em> que l&#8217;on peut aussi Ã©crire <em>P&#160;&#43;&#160;Q&#160;=&#160;O</em>. <em>O</em> est le "point Ã  l&#8217;infini" de la courbe elliptique et il joue le mÃªme rÃ´le que zÃ©ro dans l&#8217;addition des entiers. Ainsi on a <em>P&#160;&#43;&#160;O&#160;=&#160;O&#160;&#43;&#160;P&#160;=&#160;O</em> quel que soit <em>P</em> sur la courbe.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">Multiplication par un entier <em>k</em> trÃ¨s grand</div>
<p>Les <em>k</em> utilisÃ©s en pratique Ã©tant des grands nombres (de l&#8217;ordre de 2<sup>256</sup> avec <em>prime256v1</em>), il n&#8217;est pas possible de calculer <em>kP</em> en ajoutant <em>P</em> Ã  lui-mÃªme <em>k</em> fois.</p>
</div>
<div class="paragraph">
<p>Il faut utiliser l&#8217;algorithme d&#8217;exponentiation rapide vu prÃ©cÃ©demment&#160;<a href="#9">[9]</a>.
Remplacer la multiplication de deux entiers par l&#8217;addition de deux points et l&#8217;Ã©lÃ©vation Ã  la puissance par la multiplication d&#8217;un point par un entier.</p>
</div>
</div>
<div class="sect3">
<h4 id="_fonctions_de_calcul_sur_em_f_sub_p_sub_em_avec_le_programme_em_bc_em">4.1.4. Fonctions de calcul sur <em>F<sub>p</sub></em> avec le programme <em>bc</em></h4>
<div class="paragraph">
<p>Nous allons maintenant Ã©crire les fonctions de calcul d&#8217;aprÃ¨s les formules qui prÃ©cÃ¨dent.</p>
</div>
<div class="paragraph">
<p>Un point est reprÃ©sentÃ© par un tableau et la convention du script est la suivante&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Le point Ã  l&#8217;infini est codÃ© par <em>point[2]</em> diffÃ©rent de zÃ©ro</p>
</li>
<li>
<p>Sinon (si <em>point[2]</em> est nul), <em>point[0]</em> est la coordonnÃ©e <em>x</em> et <em>point[1]</em> est la coordonnÃ©e <em>y</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Le calcul de l&#8217;inverse modulaire utilise l'<em>algorithme d&#8217;Euclide Ã©tendu</em> <a href="#22">[22]</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Le script prÃ©sentÃ© plus loin contient la fonction <em>powmod</em> utilisÃ©e prÃ©cÃ©demment, pour le RSA, mais nous n&#8217;en avons pas besoin pour les calculs ECDSA.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<div class="title">L&#8217;opÃ©rateur modulo</div>
<div class="paragraph">
<p>L&#8217;opÃ©rateur <em>%</em> (<em>modulo</em>) ne fonctionne pas Ã  l&#8217;identique d&#8217;un langage Ã  l&#8217;autre ou d&#8217;une librairie Ã  l&#8217;autre.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>bc</em> renvoie un nombre dont le signe est le signe du premier argument.
Ainsi <em>(-5)&#160;%&#160;3</em> renvoie <em>-2</em>.</p>
</li>
<li>
<p><em>python</em> renvoie toujours une valeur positive. <em>(-5)&#160;%&#160;3</em> renvoie <em>1</em>.</p>
</li>
<li>
<p>La librairie <em>libgmp</em> (<em>GNU Multiple Precision Arithmetic Library</em>) renvoie toujours une valeur positive. <em>(-5)&#160;%&#160;3</em> renvoie <em>1</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Cela ne change pas la nature des calculs effectuÃ©s mais doit parfois Ãªtre pris en compte. Ainsi la fonction <em>invmod</em> (dÃ©finie dans <em>crypto.b</em> ci-dessous) ne peut pas fonctionner avec des nombres nÃ©gatifs et elle commence par "normaliser" le premier argument pour qu&#8217;il soit compris entre <em>0</em> et <em>n&#160;-&#160;1</em>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">crypto.b</div>
<div class="content">
<pre class="highlight"><code class="language-bc" data-lang="bc">	/* Calculate the invert of a modulo n */
define invmod(a, n) {
	auto aa, bb, r, t, anc_t, nou_t, negflag
	aa = n
	negflag = 0
	if (a &lt; 0) {
		negflag = 1
		a %= n
		if (a &lt; 0) a += n
	}
	bb = a
	r = 1
	t = 1
	anc_t = 0
	while (1) {
		q = aa / bb
		anc_r = r
		r = aa - bb * q

		nou_t = anc_t - q * t
		if (nou_t &gt;= 0) nou_t %= n
		if (nou_t &lt; 0) nou_t = n - (-nou_t % n)
		anc_t = t
		t = nou_t

		aa = bb
		bb = r
		if (r &lt;= 1) break;
	}

	if (r != 1) {
			/*
			   No invert can be returned =&gt; error
			   Alternate solution: return 0

			   I find triggering an error best: the calculation stops
			   immediately instead of continuing with meaningless values
			*/
		return 1 % 0
	} else {
		if (negflag) t -= n
		return t
	}
}

/*
	The well-known powmod function, sometimes referred to in bc scripts
	as "mpower".
*/
define powmod(a, b, c) {
	auto p, r
	p = a
	r = 1
	while (b &gt; 0) {
		if (b % 2) r = (r * p) % c
		p = (p * p) % c
		b /= 2
	}
	return r
}

/*
	The EC functions below use the following conventions.

	- The point at infinity has non null element of index 2 (array[2]!=0),
	  for any other point, array[2] is zero.

	- If array[2] is zero, array[0] is the x coordinate and
	  array[1] is the y coordinate.

*/

/*
	ECC addition of p and q, p[0] being different from q[0]
*/
define ec_add_core(*r[], p[], q[], m) {
	auto s
	s = ((p[1] - q[1]) * invmod(p[0] - q[0], m)) % m
	r[0] = (s^2 - p[0] - q[0]) % m
	r[1] = (s * (p[0] - r[0]) - p[1]) % m
	r[2] = 0
}

/*
   ECC point doubling
*/
define ec_dbl_core(*r[], p[], a, m) {
	auto s
	s = ((3 * p[0]^2 + a) * invmod(2 * p[1], m)) % m
	r[0] = (s^2 - 2 * p[0]) % m
	r[1] = (s * (p[0] - r[0]) - p[1]) % m
	r[2] = 0
}

/*
	ECC addition of p and q for any value of p and q
*/
define ec_add(*r[], p[], q[], a, m) {
	if (p[2]) { r[0] = q[0]; r[1] = q[1]; r[2] = q[2]; return }
	if (q[2]) { r[0] = p[0]; r[1] = p[1]; r[2] = p[2]; return }
	if (p[0] == q[0]) {
		if (p[1] != q[1]) {
			r[2] = 1  /* We don't verify whether p[1]==-q[1] as it should... */
		} else {
			if (p[2]) {
				r[2] = 1
				return
			}
			.=ec_dbl_core(r[], p[], a, m)
		}
	} else {
		.=ec_add_core(r[], p[], q[], m)
	}
}

/*
   ECC scalar point multiplication
*/
define ec_mul(*r[], p[], k, a, m) {
	auto tmp[]
	r[2] = 1
	if (p[2]) return
	while (k &gt; 0) {
		if ((k % 2) == 1) {
			.=ec_add(r[], r[], p[], a, m)
		}
			/*
			 * ec_add(p[], p[], p[], a, m) does not work with bc,
			 * need to use a temporary array.
			 */
		.=ec_add(tmp[], p[], p[], a, m)
		p[0]=tmp[0]
		p[1]=tmp[1]
		p[2]=tmp[2]
		k /= 2
	}
	if (!r[2]) {
		if (r[0] &lt; 0) r[0] += m
		if (r[1] &lt; 0) r[1] += m
	}
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Le ".=" dans le script bc</div>
<div class="paragraph">
<p><em>bc</em> permet de dÃ©clarer une fonction <em>void</em> pour qu&#8217;elle ne renvoie pas de valeur, exemple&#160;:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>define void myprint(x) { print "x=", x, "\n" }</pre>
</div>
</div>
<div class="paragraph">
<p>La version Windows de <em>bc</em> (GnuWin32) est ancienne et ne reconnaÃ®t pas le mot-clÃ© <em>void</em>. Le script <em>crypto.b</em> a Ã©tÃ© conÃ§u pour Ãªtre compatible avec cette version. Pour Ã©viter qu&#8217;une expression (ici l&#8217;appel d&#8217;une fonction) ne produise un affichage parasite, chaque appel est prÃ©cÃ©dÃ© de ".=". Ainsi le rÃ©sultat est affectÃ© Ã  la variable <em>last</em> (qui vaut toujours la derniÃ¨re valeur calculÃ©e). Cela ne modifie donc pas le cacul. C&#8217;est la mÃ©thode usuelle avec <em>bc</em> pour ne pas afficher le rÃ©sultat d&#8217;une expression.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_les_courbes_elliptiques_dans_le_standard_x509">4.2. Les courbes elliptiques dans le standard x509</h3>
<div class="sect3">
<h4 id="_reprÃ©sentation_d_un_point_dans_le_standard_x509">4.2.1. ReprÃ©sentation d&#8217;un point dans le standard x509</h4>
<div class="paragraph">
<p>Un point de la courbe d&#8217;abscisse <em>x</em> donnÃ©e ne peut avoir que deux valeurs de <em>y</em> (du fait du terme <em>y<sup>2</sup></em> des Ã©quations).</p>
</div>
<div class="paragraph">
<p>Le standard X9.62 dÃ©finit la mÃ©thode pour dÃ©signer quel <em>y</em> est le bon, en utilisant un seul bit d&#8217;information. Ainsi l&#8217;enregistrement de <em>x</em> et du bit d&#8217;information pour retrouver le bon <em>y</em> suffisent Ã  coder un point, et cette forme est dite <em>compressÃ©e</em>. Comme il est en plus possible de mÃ©langer les formes (compressÃ©e et non compressÃ©e), un point peut Ãªtre codÃ© de trois maniÃ¨res&#160;:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">La forme non compressÃ©e</dt>
<dd>
<p>Enregistrement des deux coordonnÃ©es</p>
</dd>
<dt class="hdlist1">La forme compressÃ©e</dt>
<dd>
<p>Enregistrement de <em>x</em> et du bit d&#8217;information relatif Ã  <em>y</em></p>
</dd>
<dt class="hdlist1">La forme hybride</dt>
<dd>
<p>Enregistrement de <em>x</em>, <em>y</em> et du bit d&#8217;information relatif Ã  <em>y</em></p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Sur <em>F<sub>p</sub></em> on a <em>y<sub>1</sub>&#160;=&#160;-y<sub>2</sub></em> (car non seulement <em>y</em> apparaÃ®t sous la forme <em>y<sup>2</sup></em>, mais en plus, il est isolÃ© Ã  gauche du signe <em>Ã©gal</em>) et comme nous sommes dans l&#8217;arithmÃ©tique modulaire on peut rÃ©-Ã©crire cette Ã©galitÃ© <em>y<sub>1</sub>&#160;&#43;&#160;y<sub>2</sub>&#160;=&#160;p</em>.
<em>p</em> Ã©tant impair, <em>y<sub>1</sub></em> et <em>y<sub>2</sub></em> n&#8217;ont pas mÃªme paritÃ©. Le bit d&#8217;information est le dernier bit de <em>y</em> (sa paritÃ©). On comprend aisÃ©ment que la forme hybride ne prÃ©sente aucun intÃ©rÃªt sur <em>F<sub>p</sub></em>, puisqu&#8217;un simple examen de <em>y</em> donne le bit d&#8217;information Ã  employer dans la forme compressÃ©e. La forme hybride apporte un plus sur <em>F<sub>2<sup>m</sup></sub></em> oÃ¹ le bit d&#8217;information doit Ãªtre calculÃ©.</p>
</div>
<div class="paragraph">
<p>Le standard x509 (ici la RFC 5480) permet de coder un point soit sous forme compressÃ©e, soit sous forme non compressÃ©e. La RFC 5480 interdit expressÃ©ment la forme hybride dÃ©finie par le standard X9.62.</p>
</div>
<div class="paragraph">
<p>Selon le standard X9.62 en vigueur dans la RFC 5480 (nous ne mentionnons donc pas ici la forme hybride, interdite par la RFC 5480) les formes compressÃ©e et non compressÃ©e sont codÃ©es ainsi<sup class="footnote">[<a id="_footnoteref_20" class="footnote" href="#_footnote_20" title="View footnote.">20</a>]</sup>&#160;:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Premier octet = <em>02</em>&#160;: le point est compressÃ©, et <em>y</em> est pair. <em>x</em> est codÃ© juste aprÃ¨s 02.</p>
</li>
<li>
<p>Premier octet = <em>03</em>&#160;: le point est compressÃ©, et <em>y</em> est impair. <em>x</em> est codÃ© juste aprÃ¨s 03.</p>
</li>
<li>
<p>Premier octet = <em>04</em>&#160;: le point est non compressÃ©. <em>x</em> est codÃ© juste aprÃ¨s 04, et <em>y</em> est codÃ© juste aprÃ¨s <em>x</em>. Comme <em>x</em> et <em>y</em> ont mÃªme taille, il n&#8217;y a pas besoin de dÃ©limiteur pour retrouver la position Ã  laquelle on passe de <em>x</em> Ã  <em>y</em>.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="title">Conversion entre format compressÃ© et non comrpessÃ©</div>
<div class="paragraph">
<p>Pour retrouver le <em>y</em> qui satisfasse l&#8217;Ã©quation <em>y<sup>2</sup> = x<sup>3</sup> + ax + b</em>, il faut calculer le terme Ã  droite du signe Ã©gal puis en extraire la racine carrÃ©e (dans <em>Z/pZ</em>&#160;: il s&#8217;agit de la <em>racine modulaire</em>), et enfin choisir le bon <em>y</em> d&#8217;aprÃ¨s le bit de paritÃ©.</p>
</div>
<div class="paragraph">
<p>D&#8217;aprÃ¨s <a href="#23">[23]</a>, il n&#8217;existe pas d&#8217;algorithme dÃ©terministe qui calcule la racine modulaire en temps polynomial. Cette mÃªme source donne un algorithme de type Monte-Carlo (qui fait donc intervenir le hasard) en <em>temps moyen</em> polynomial, ce qui est suffisant dans la pratique.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_la_courbe_prime256v1_secp256r1">4.2.2. La courbe prime256v1 (secp256r1)</h4>
<div class="paragraph">
<div class="title">Les paramÃ¨tres de la courbe prime256v1</div>
<p>RÃ©cupÃ©rons les paramÃ¨tres (depuis <em>openssl</em> ou depuis ce document&#160;<a href="#18">[18]</a>) de la courbe et enregistrons-les dans le fichier <em>secp256r1.b</em>.</p>
</div>
<div class="paragraph">
<p>Pour reprÃ©senter un point de la courbe nous utilisons la convention <em>point[0] = abscisse du point</em> et <em>point[1] = ordonnÃ©e du point</em>. Le point Ã  l&#8217;infini est reprÃ©sentÃ© par <em>point[2] = 1</em> (<em>point[2] = 0</em> pour tout autre point).</p>
</div>
<div class="listingblock">
<div class="title">secp256r1.b</div>
<div class="content">
<pre class="highlight"><code class="language-bc" data-lang="bc">save_ibase=ibase
ibase=2^4
p=FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFF
a=FFFFFFFF00000001000000000000000000000000FFFFFFFFFFFFFFFFFFFFFFFC
b=5AC635D8AA3A93E7B3EBBD55769886BC651D06B0CC53B0F63BCE3C3E27D2604B
g[0]=6B17D1F2E12C4247F8BCE6E563A440F277037D812DEB33A0F4A13945D898C296
g[1]=4FE342E2FE1A7F9B8EE7EB4A7C0F9E162BCE33576B315ECECBB6406837BF51F5
g[2]=0
n=FFFFFFFF00000000FFFFFFFFFFFFFFFFBCE6FAADA7179E84F3B9CAC2FC632551
h=1
ibase=save_ibase</code></pre>
</div>
</div>
<div class="paragraph">
<p>Au passage, on peut vÃ©rifier que le point <em>G</em> fait bien partie de la courbe&#160;:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-verif-prime256v1-redim.png" alt="VÃ©rification prime256v1">
</div>
<div class="title">Fig. 32 </div>
</div>
<div class="paragraph">
<p>On peut Ã©galement vÃ©rifier que <em>nG&#160;=&#160;O</em>, <em>O</em> Ã©tant le point Ã  l&#8217;infini.
Dans la convention des fonctions de <em>crypto.b</em>, le point Ã  l&#8217;infini est codÃ© par une valeur non nulle de l&#8217;Ã©lÃ©ment d&#8217;indice <em>2</em>&#160;:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-n_fois_g-redim.png" alt="n fois G">
</div>
<div class="title">Fig. 33 </div>
</div>
<div class="paragraph">
<div class="title">CrÃ©ation d&#8217;une paire de clÃ©s privÃ©e et publique sur prime256v1</div>
<p>ExÃ©cuter <sup class="footnote">[<a id="_footnoteref_21" class="footnote" href="#_footnote_21" title="View footnote.">21</a>]</sup></p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ openssl ecparam -name prime256v1 -genkey -out k.pem</pre>
</div>
</div>
<div class="paragraph">
<p>Examiner le rÃ©sultat avec</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ openssl ec -in k.pem -noout -text</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-key-redim.png" alt="ECC key">
</div>
<div class="title">Fig. 34 </div>
</div>
<div class="paragraph">
<p>Par dÃ©faut, <em>openssl</em> enregistre les clÃ©s publiques sous forme non compressÃ©e, ce que l&#8217;on peut voir au <em>04</em> qui dÃ©marre la suite d&#8217;octets en-dessous de "pub:".</p>
</div>
<div class="paragraph">
<p>Ã l&#8217;aide de la commande <em>openssl</em> ci-dessus (ou bien avec <em>pkfile</em>, ou encore <em>dder</em>), copier-coller les valeurs de la clÃ© privÃ©e et publique dans <em>k.b</em>, sous les noms <em>k</em> et <em>q[]</em>, respectivement.</p>
</div>
<div class="listingblock">
<div class="title">k.b</div>
<div class="content">
<pre class="highlight"><code class="language-bc" data-lang="bc">save_ibase=ibase
ibase=2^4
k=673DCAD121E37B7E15AC792F8CA0670856E2DE9C233684A9A0FA3D767B61FBF1
q[0]=134D4E5F632E0545350FB89EE05200450E07A5B115BCA72DF5F4896D2433A65A
q[1]=A1A33A97ACB4E40D0519CB029B1E85E26D3D6B3D7FF3D3626127D0C045392D91
q[2]=0
ibase=save_ibase</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">Calcul de la clÃ© publique d&#8217;aprÃ¨s la clÃ© privÃ©e</div>
<p>On peut facilement calculer <em>Q</em> (la clÃ© publique) d&#8217;aprÃ¨s <em>k</em> (la clÃ© privÃ©e). Au passage, cela permet de vÃ©rifier le bon fonctionnement de la chaÃ®ne&#160;:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Les fonctions de <em>crypto.b</em></p>
</li>
<li>
<p>Les paramÃ¨tres de domaine de <em>prime256v1</em></p>
</li>
<li>
<p>La dÃ©finition dans <em>k.b</em> des valeurs de la paire de clÃ©s privÃ©e et publique</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-k_fois_g-redim.png" alt="k fois G">
</div>
<div class="title">Fig. 35 </div>
</div>
</div>
<div class="sect3">
<h4 id="_crÃ©ation_d_un_certificat_auto_signÃ©">4.2.3. CrÃ©ation d&#8217;un certificat auto-signÃ©</h4>
<div class="paragraph">
<p>Par dÃ©finition, un certificat auto-signÃ© a mÃªme Ã©metteur (<em>issuer</em>) et sujet (<em>subject</em>).
Sa clÃ© sera celle du fichier <em>k.pem</em>.</p>
</div>
<div class="paragraph">
<p>ExÃ©cuter la commande&#160;:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ openssl req -new -x509 -key k.pem -subj "/CN=Sebastien Millet DEV CA/C=FR" -out cert.pem</pre>
</div>
</div>
<div class="paragraph">
<p>ContrÃ´ler le rÃ©sultat avec cette commande&#160;:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>$ openssl x509 -in cert.pem -noout -text</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-openssl-autosigned-redim.png" alt="CrÃ©ation certificat auto-signÃ©">
</div>
<div class="title">Fig. 36 </div>
</div>
</div>
<div class="sect3">
<h4 id="_vÃ©rification_de_la_signature_ecdsa_du_certificat">4.2.4. VÃ©rification de la signature ECDSA du certificat</h4>
<div class="paragraph">
<div class="title">Signature d&#8217;un message avec ECDSA</div>
<p>Les formules sont disponibles sur de nombreux sites, par exemple ici&#160;<a href="#24">[24]</a>.</p>
</div>
<div class="paragraph">
<p>Ce tutoriel (en anglais) est trÃ¨s bien fait et explique dans le dÃ©tail de nombreux calculs&#160;<a href="#25">[25]</a>.</p>
</div>
<div class="paragraph">
<p>Jusqu&#8217;Ã  prÃ©sent <em>k</em> dÃ©signait la clÃ© privÃ©e. Ci-dessous <em>k</em> est un entier choisi alÃ©atoirement, alors que la clÃ© privÃ©e est notÃ©e <em>d</em>.</p>
</div>
<div class="paragraph">
<p>Les notations sont celles introduites prÃ©cÃ©demment pour les paramÃ¨tres de domaine ainsi que la clÃ© publique.
Le message Ã  signer est notÃ© <em>m</em> et son hash est notÃ© <em>H(m)</em>.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Choisir un entier k entre <em>0</em> et <em>n</em>, diffÃ©rent de <em>0</em> et de <em>n</em></p>
</li>
<li>
<p>Calculer <span class="image"><img src="./images/img-sig-formula-1.png" alt="ECDSA Formule 1"></span> Si <em>r</em> est Ã©gal Ã  <em>0</em>, recommencer Ã  l&#8217;Ã©tape <em>1</em></p>
</li>
<li>
<p>Calculer <span class="image"><img src="./images/img-sig-formula-2.png" alt="ECDSA Formule 2"></span> Si <em>s</em> est Ã©gal Ã  zÃ©ro, recommencer Ã  l&#8217;Ã©tape <em>1</em></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
La division par <em>k</em> est une multiplication par <em>k<sup>-1</sup>&#160;mod&#160;n</em>.
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
<em>k</em> doit Ãªtre cryptographiquement alÃ©atoire, et diffÃ©rent Ã  chaque signature. Si une clÃ© signe deux documents diffÃ©rents avec un <em>k</em> unique, il est trivial de la calculer. Le lien <a href="#25">[25]</a> en donne la dÃ©monstration et dÃ©crit un cas pratique avec le programme <em>openssl</em> modifiÃ© pour signer avec un <em>k</em> invariable.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Le couple <em>(r,&#160;s)</em> est la signature de <em>H(m)</em>.</p>
</div>
<div class="olist arabic">
<div class="title">VÃ©rification d&#8217;une signature ECDSA</div>
<ol class="arabic">
<li>
<p>Calculer <span class="image"><img src="./images/img-sig-formula-3.png" alt="ECDSA Formule 3"></span> et <span class="image"><img src="./images/img-sig-formula-4.png" alt="ECDSA Formule 4"></span></p>
</li>
</ol>
</div>
<div class="olist arabic">
<ol class="arabic" start="2">
<li>
<p>Calculer <span class="image"><img src="./images/img-sig-formula-5.png" alt="ECDSA Formule 5"></span></p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Dans les formules de calcul de <em>u<sub>1</sub></em> et <em>u<sub>2</sub></em>, on pourrait se passer du deuxiÃ¨me <em>mod&#160;n</em>, mais le calcul serait un peu plus long.
</td>
</tr>
</table>
</div>
<div class="olist arabic">
<ol class="arabic" start="3">
<li>
<p>VÃ©rifier que <em>p&#160;=&#160;r</em></p>
</li>
</ol>
</div>
<div class="paragraph">
<div class="title">VÃ©rification de notre certificat auto-signÃ©</div>
<p>L&#8217;encodage de <em>(r, s)</em> est standardisÃ© par la RFC 5280. Il s&#8217;agit de la dÃ©finition suivante&#160;:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>ECDSA-Sig-Value ::= SEQUENCE {
	r  INTEGER,
	s  INTEGER
}</pre>
</div>
</div>
<div class="paragraph">
<p>Si vous vous rappelez les chapitres prÃ©cÃ©dents concernant le RSA, la signature (ici la valeur de <em>(r,&#160;s)</em>) est la troisiÃ¨me sÃ©quence du certificat. Avec <em>pkfile</em> il s&#8217;agit du noeud de coordonnÃ©es <em>1.3.1</em>.</p>
</div>
<div class="paragraph">
<p>Nous allons rÃ©cupÃ©rer les valeurs de <em>r</em> et <em>s</em> du certificat et les Ã©crire dans le fichier <em>sign.b</em>.
Deux possibilitÃ©s pour afficher <em>r</em> et <em>s</em>&#160;:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Avec <em>pkfile</em> (la premiÃ¨re commande permet de voir que nous avons besoin de dÃ©coder la valeur <em>1.3.1</em>)&#160;:</p>
<div class="literalblock">
<div class="content">
<pre>pkfile cert.pem -l 3
pkfile cert.pem -N 1.3.1</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-pkfile-cert-1-redim.png" alt="pkfile 1">
</div>
<div class="title">Fig. 37 </div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-pkfile-cert-2-redim.png" alt="pkfile 2">
</div>
<div class="title">Fig. 38 </div>
</div>
</li>
<li>
<p>Avec <em>openssl</em> (la premiÃ¨re commande permet de voir que nous avons besoin de dÃ©coder la valeur situÃ©e Ã  l&#8217;offset <em>351</em>)&#160;:</p>
<div class="literalblock">
<div class="content">
<pre>openssl asn1parse -in cert.pem
openssl asn1parse -in cert.pem -strparse 351</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-openssl-strparse-redim.png" alt="openssl straparse">
</div>
<div class="title">Fig. 39 </div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Nous avons Ã©galement besoin de <em>H(m)</em>, que nous noterons <em>hm</em> dans notre script (dans certains tutoriels il est notÃ© <em>e</em>). Comme vu avec le RSA il faut extraire la partie tbsCertificate de notre certificat et en calculer le hash.</p>
</div>
<div class="paragraph">
<p>Quel hash&#160;? Le certificat indique que l&#8217;algorithme est <em>ecdsa-with-SHA256</em>, donc <em>hm&#160;=&#160;SHA256(tbsCertificate)</em>.</p>
</div>
<div class="olist arabic">
<div class="title">Calcul de hm</div>
<ol class="arabic">
<li>
<p>Extraire tbsCertificate dans <em>tbs.der</em>&#160;:</p>
<div class="literalblock">
<div class="content">
<pre>pkfile cert.pem -n 1.1 -x -o tbs.der</pre>
</div>
</div>
</li>
<li>
<p>Calculer le hash SHA256 de <em>tbs.der</em>&#160;:</p>
</li>
</ol>
</div>
<div class="exampleblock">
<div class="title">Linux</div>
<div class="content">
<div class="literalblock">
<div class="content">
<pre>$ sha256sum tbs.der</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-pkfile-cert-4-redim.png" alt="pkfile 4">
</div>
<div class="title">Fig. 40 </div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Windows</div>
<div class="content">
<div class="literalblock">
<div class="content">
<pre>pkfile --sha256 tbs.der</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-pkfile-cert-3-redim.png" alt="pkfile 3">
</div>
<div class="title">Fig. 41 </div>
</div>
</div>
</div>
<div class="paragraph">
<p>AprÃ¨s ces manipulations le fichier <em>sign.b</em> contient <em>r</em>, <em>s</em> et <em>hm</em>.</p>
</div>
<div class="listingblock">
<div class="title">sign.b</div>
<div class="content">
<pre class="highlight"><code class="language-bc" data-lang="bc">save_ibase=ibase
ibase=2^4
r=EAAF9A71679B8DB097D9B3FD6F1269722F9064719AA0F9EBA609EBEAA2137249
s=341F2779CFA258038389553A62494793D57F06CD3AF3DA1758C05ECDF680F7F5
hm=FA7C84F7AD64B726AC9261CE4B7DAB683CE9E34491A2C4EAB7F116FA7F1D2142
ibase=save_ibase</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ne reste plus qu&#8217;Ã  faire les calculs&#160;:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-sig-verif-1-redim.png" alt="VÃ©rification signature  1">
</div>
<div class="title">Fig. 42 </div>
</div>
<div class="paragraph">
<p>On voit que l&#8217;abscisse du rÃ©sultat est bien Ã©gale Ã  <em>r</em> ce qui valide la signature.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_les_certificats_Ãlectroniques_visibles">4.3. Les Certificats Ãlectroniques Visibles</h3>
<div class="sect3">
<h4 id="_prÃ©sentation">4.3.1. PrÃ©sentation</h4>
<div class="paragraph">
<p>Le CEV ou <em>Certificat Ãlectronique Visible</em> est un certificat au format 2D-Doc, mis en place par l&#8217;ANTS (<em>Agence Nationale des Titres SÃ©curisÃ©s</em>).
Il est dÃ©crit Ã  cette URL&#160;<a href="#26">[26]</a>.</p>
</div>
<div class="paragraph">
<p>Le lien <a href="#26">[26]</a> permet de tÃ©lÃ©charger le document <em>ANTS_2D-Doc_CABSpec_v2.0.1_erratum.pdf</em>, qui en donne tous les dÃ©tails techniques ainsi que quelques exemples. Par la suite nous le dÃ©signerons simplement comme "le document 2D-Doc".</p>
</div>
</div>
<div class="sect3">
<h4 id="_vÃ©rification_manuelle_d_une_signature_2d_doc">4.3.2. VÃ©rification manuelle d&#8217;une signature 2D-Doc</h4>
<div class="paragraph">
<p>Nous allons vÃ©rifier la signature du code donnÃ© en page 59 du document 2D-Doc&#160;:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-2ddoc-expg58-redim.png" alt="Exemple certificat 2D-Doc page 58">
</div>
<div class="title">Fig. 43 </div>
</div>
<div class="paragraph">
<p>Nous utiliserons le fichier <em>2Ddoc-values.b</em> pour stocker les nombres correspondants.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>En page 58 du document 2D-Doc se trouve le certificat de l&#8217;autoritÃ© de certification de test (l'<em>Ã©metteur</em>). Copier-coller le certificat dans un Ã©diteur de texte et l&#8217;enregistrer dans le fichier <em>0001.pem</em>.</p>
</li>
<li>
<p>Extraire de ce fichier les valeurs de la clÃ© publique Ã  l&#8217;aide d'<em>openssl</em>. Le document indique que la clÃ© est de type <em>NIST&#160;P-256</em>, ce qui correspond Ã  la courbe <em>prime256v1</em> que nous avons Ã©tudiÃ©e prÃ©cÃ©demment et pour laquelle nous disposons dÃ©jÃ  des paramÃ¨tres (fichier <em>secp256r1.b</em>).</p>
<div class="paragraph">
<p>Nous n&#8217;utiliserons pas la clÃ© privÃ©e qui sert Ã  tester le mÃ©canisme de signature - nous allons uniquement vÃ©rifier une signature existante.</p>
</div>
</li>
<li>
<p>Copier-coller la partie signÃ©e du document ("DonnÃ©es signÃ©es") dans le fichier <em>msg2ddoc-signed.bin</em>.</p>
</li>
<li>
<p>Extraire les variables <em>r</em> et <em>s</em> de la signature ("Signature (binaire)").</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Dans le document signÃ© (enregistrÃ© dans <em>msg2ddoc-signed.bin</em>), les sÃ©quences <em>&lt;GS&gt;</em> doivent Ãªtre remplacÃ©es par le code ASCII <em>29</em>, et il faut savoir qu&#8217;il y a un espace (et un seul) entre <em>DES</em> et <em>SPECIMENS</em> (l&#8217;affichage n&#8217;est pas clair sur ce point).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Au final le fichier <em>2Ddoc-values.b</em> contient ceci&#160;:</p>
</div>
<div class="listingblock">
<div class="title">2Ddoc-values.b</div>
<div class="content">
<pre class="highlight"><code class="language-bc" data-lang="bc">save_ibase=ibase
ibase=2^4
q[0]=A98F0D7CCD62808893BEC4D436E79D1834A1D6E001D70F1C4CDCCD9D9E2FE229
q[1]=F7240514E8DDC0CA98D0C7440C9CC492849A0FBDA73FC392F4DA0AE07F84C23C
q[2]=0
r=CE8F257E996794F5FE8BF395F6C7FF349E67B5B4C6084E66BFEAFAE122CAABAF
s=3AED1D025719506E447FE2FFB0C773F52CFB2804A3D4BF49F63C3228E9100CB1
hm=91337295417C81EE146FCBDE613DA9D3C8987BAA287200905B541B5681633E00
ibase=save_ibase</code></pre>
</div>
</div>
<div class="paragraph">
<p>Comme prÃ©cÃ©demment, il ne nous reste plus qu&#8217;Ã  faire les calculs.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-2ddoc-verif-manual-redim.png" alt="VÃ©rification 2D-Doc manuelle">
</div>
<div class="title">Fig. 44 </div>
</div>
<div class="paragraph">
<p><em>t[0]</em> est l&#8217;abscisse de <em>u<sub>1</sub>G&#160;+&#160;u<sub>2</sub>Q</em> et comme attendu il est ben Ã©gal Ã  <em>r</em>, ce qui valide la signature.</p>
</div>
<div class="paragraph">
<p>Pour Ãªtre rigoureux il aurait fallu comparer <em>r</em> avec <em>t[0]&#160;%&#160;n</em>, comme ici <em>t[0]&#160;&lt;&#160;n</em> nous avons omis ce calcul.</p>
</div>
</div>
<div class="sect3">
<h4 id="_vÃ©rification_d_une_signature_2d_doc_avec_em_openssl_em">4.3.3. VÃ©rification d&#8217;une signature 2D-Doc avec <em>openssl</em></h4>
<div class="paragraph">
<p>La signature (partie "Signature (binaire)") n&#8217;est pas exploitable telle quelle, elle doit Ãªtre "emballÃ©e" pour Ãªtre conforme Ã  la structure <code>ECDSA-Sig-Value</code> prÃ©sentÃ©e prÃ©cÃ©demment.</p>
</div>
<div class="paragraph">
<p>Ce qui suit est Ã©laborÃ© d&#8217;aprÃ¨s le standard X.690.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>En hexadÃ©cimal, ajouter <em>02&#160;21&#160;00</em> avant <em>r</em>, et <em>02&#160;20</em> avant <em>s</em>. Ensuite ajouter <em>30&#160;45</em> au tout dÃ©but du fichier.</p>
<div class="ulist">
<ul>
<li>
<p>Pourquoi ajouter un zÃ©ro devant <em>r</em>&#160;? L&#8217;entier <em>r</em> commence par <em>CE</em> (base 16). Le type <code>INTEGER</code> en ASN.1 est signÃ©.
Tel quel, <em>r</em> serait lu comme nÃ©gatif du fait du bit de poids fort Ã©gal Ã  1.
<em>s</em> commence par <em>3A</em> (base 16) et n&#8217;a donc pas besoin d&#8217;Ãªtre prÃ©fixÃ© avec un octet nul.</p>
<div class="paragraph">
<p>Sans cet ajout d&#8217;un octet nul devant <em>r</em>, <em>openssl</em> lit un entier nÃ©gatif Ã©gal Ã  <em>r&#160;-&#160;2<sup>256</sup></em>&#160;:
<em>-3170DA8166986B0A01740C6A093800CB61984A4B39F7B1994015051EDD355451</em> (base 16)</p>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Enregistrer le fichier (hexadÃ©cimal) comme <em>2ddoc-signature-wrapped.hex</em>.</p>
<div class="listingblock">
<div class="title">2ddoc-signature-wrapped.hex</div>
<div class="content">
<pre>3045
0221
00ce8f257e996794f5fe8bf395f6c7ff349e67b5b4c6084e66bfeafae122caabaf
0220
3aed1d025719506e447fe2ffb0c773f52cfb2804a3d4bf49f63c3228e9100cb1</pre>
</div>
</div>
</li>
<li>
<p>Convertir le contenu hexadÃ©cimal en binaire et l&#8217;enregistrer comme <em>2ddoc-signature-wrapped.bin</em>. C&#8217;est cette signature qui sera examinÃ©e par <em>openssl</em>. Vous pouvez vÃ©rifier le rÃ©sultat avec la commande</p>
<div class="literalblock">
<div class="content">
<pre>$ openssl asn1parse -inform der -in 2ddoc-signature-wrapped.bin</pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-2ddoc-asn1parse-redim.png" alt="2D-Doc parse asn1">
</div>
<div class="title">Fig. 45 </div>
</div>
</li>
<li>
<p>Le certificat (fichier <em>0001.pem</em>) ne peut pas Ãªtre exploitÃ© tel quel par <em>openssl&#160;dgst</em>, il faut en extraire la clÃ© publique. ExÃ©cuter la commande suivante&#160;:</p>
<div class="literalblock">
<div class="content">
<pre>openssl x509 -in 0001.pem -noout -pubkey &gt; 0001-pubkey.pem</pre>
</div>
</div>
<div class="paragraph">
<p>Le fichier <em>0001-pubkey.pem</em> contient la clÃ© publique de "0001", et rien d&#8217;autre.</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Il ne nous reste plus qu&#8217;Ã  demander Ã  <em>openssl</em> de vÃ©rifier tout cela. ExÃ©cuter la commande&#160;:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>openssl dgst -sha256 -verify 0001-pubkey.pem -signature 2ddoc-signature-wrapped.bin msg2ddoc-signed.bin</pre>
</div>
</div>
<div class="paragraph">
<p>RÃ©sultat&#160;:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/img-2ddoc-verif-with-openssl-redim.png" alt="VÃ©rification 2D-Doc avec openssl">
</div>
<div class="title">Fig. 46 </div>
</div>
<div class="paragraph">
<p><em>openssl</em> nous dit <code>Verified OK</code>.</p>
</div>
<div class="paragraph">
<p>VoilÃ  qui clÃ´t ces manipulations autour de la cryptographie Ã  courbes elliptiques dans les cadres x509 et 2D-Doc.</p>
</div>
<div class="paragraph">
<p>N&#8217;oubliez pas que la validation d&#8217;un certificat nÃ©cessite d&#8217;autres Ã©tapes que la seule vÃ©rification d&#8217;une signature ECDSA.
Si vous devez valider un certificat dans un environnement de production, seul un logiciel adaptÃ© pourra le faire de maniÃ¨re fiable.</p>
</div>
<div class="paragraph">
<p><strong>FIN</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_bibliographie">5. Bibliographie</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong><a id="1"></a>[1]</strong> PrÃ©sentation de l&#8217;ASN.1&#160;: <a href="http://www.itu.int/en/ITU-T/asn1/Pages/introduction.aspx" class="bare">http://www.itu.int/en/ITU-T/asn1/Pages/introduction.aspx</a></p>
</li>
<li>
<p><strong><a id="2"></a>[2]</strong> Document X.690 (format PDF)&#160;: <a href="https://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf" class="bare">https://www.itu.int/ITU-T/studygroups/com17/languages/X.690-0207.pdf</a></p>
</li>
<li>
<p><strong><a id="3"></a>[3]</strong> Article WikipÃ©dia consacrÃ© au X.690&#160;: <a href="https://en.wikipedia.org/wiki/X.690" class="bare">https://en.wikipedia.org/wiki/X.690</a></p>
</li>
<li>
<p><strong><a id="4"></a>[4]</strong> RFC 5280 (certificats x509 v3)&#160;: <a href="https://tools.ietf.org/html/rfc5280" class="bare">https://tools.ietf.org/html/rfc5280</a></p>
</li>
<li>
<p><strong><a id="5"></a>[5]</strong> Article WikipÃ©dia consacrÃ© au RSA&#160;: <a href="https://fr.wikipedia.org/wiki/Chiffrement_RSA" class="bare">https://fr.wikipedia.org/wiki/Chiffrement_RSA</a></p>
</li>
<li>
<p><strong><a id="6"></a>[6]</strong> Page d&#8217;accueil de <em>bc</em>&#160;: <a href="https://www.gnu.org/software/bc/" class="bare">https://www.gnu.org/software/bc/</a></p>
</li>
<li>
<p><strong><a id="7"></a>[7]</strong> <em>bc</em> pour Windows&#160;: <a href="http://gnuwin32.sourceforge.net/packages/bc.htm" class="bare">http://gnuwin32.sourceforge.net/packages/bc.htm</a></p>
<div class="paragraph">
<p><em>bc</em> a besoin du fichier <em>readline5.dll</em> pour s&#8217;exÃ©cuter. Vous pouvez le trouver Ã  cette URL&#160;: <a href="http://gnuwin32.sourceforge.net/packages/readline.htm" class="bare">http://gnuwin32.sourceforge.net/packages/readline.htm</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<div class="title">Important</div>
</td>
<td class="content">
Le fichier exÃ©cutable <em>bc.exe</em> semble mal gÃ©rer le clavier franÃ§ais, Ã  cause de <em>readline</em>. Cela oblige Ã  jongler pour saisir des caractÃ¨rs tels que '^', '{' et '[', et il faut parfois passer en mode "clavier anglais" pour s&#8217;en sortir. Une alternative est de compiler <em>bc</em> sans <em>readline</em>. L&#8217;auteur de ce document a compilÃ© <em>bc</em> sans <em>readline</em> et l&#8217;a publiÃ© ici&#160;: <a href="http://seb-o-fourneaux.fr/?p=116" class="bare">http://seb-o-fourneaux.fr/?p=116</a>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><strong><a id="8"></a>[8]</strong> Le site de notepad++ &#160;: <a href="https://notepad-plus-plus.org/fr" class="bare">https://notepad-plus-plus.org/fr</a></p>
</li>
<li>
<p><strong><a id="9"></a>[9]</strong> Article WikipÃ©dia sur l&#8217;algorithme d&#8217;exponentiation rapide&#160;: <a href="https://fr.wikipedia.org/wiki/Exponentiation_rapide" class="bare">https://fr.wikipedia.org/wiki/Exponentiation_rapide</a></p>
</li>
<li>
<p><strong><a id="10"></a>[10]</strong> Article WikipÃ©dia sur l&#8217;exponentiation modulaire&#160;: <a href="https://fr.wikipedia.org/wiki/Exponentiation_modulaire" class="bare">https://fr.wikipedia.org/wiki/Exponentiation_modulaire</a></p>
</li>
<li>
<p><strong><a id="11"></a>[11]</strong> Obtenir <em>dder</em>&#160;: <a href="http://dder.sourceforge.net" class="bare">http://dder.sourceforge.net</a></p>
</li>
<li>
<p><strong><a id="12"></a>[12]</strong> Obtenir <em>pkfile</em>&#160;: <a href="http://pkfile.sourceforge.net" class="bare">http://pkfile.sourceforge.net</a></p>
</li>
<li>
<p><strong><a id="13"></a>[13]</strong> GNUWin32&#160;: <a href="http://gnuwin32.sourceforge.net/packages/openssl.htm" class="bare">http://gnuwin32.sourceforge.net/packages/openssl.htm</a></p>
</li>
<li>
<p><strong><a id="14"></a>[14]</strong> TÃ©lÃ©charger 7-ZIP&#160;: <a href="http://www.7-zip.org/download.html" class="bare">http://www.7-zip.org/download.html</a></p>
</li>
<li>
<p><strong><a id="15"></a>[15]</strong> Peter Seibt, Andreea Dragut Cours de cryptographie Chapitre V (format PDF)&#160;: <a href="http://www.dil.univ-mrs.fr/~jfp/master/m03/CompresChap5AES.pdf" class="bare">http://www.dil.univ-mrs.fr/~jfp/master/m03/CompresChap5AES.pdf</a></p>
</li>
<li>
<p><strong><a id="16"></a>[16]</strong> An introduction to elliptic curve cryptography&#160;: <a href="http://www.embedded.com/design/safety-and-security/4396040/An-Introduction-to-Elliptic-Curve-Cryptography" class="bare">http://www.embedded.com/design/safety-and-security/4396040/An-Introduction-to-Elliptic-Curve-Cryptography</a></p>
</li>
<li>
<p><strong><a id="17"></a>[17]</strong> Corps finis (format PDF)&#160;: <a href="http://iml.univ-mrs.fr/~rodier/Cours/RappelCorps%20finis.pdf" class="bare">http://iml.univ-mrs.fr/~rodier/Cours/RappelCorps%20finis.pdf</a></p>
</li>
<li>
<p><strong><a id="18"></a>[18]</strong> SEC 2: Recommended Elliptic Curve Domain Parameters (format PDF)&#160;: <a href="http://www.secg.org/SEC2-Ver-1.0.pdf" class="bare">http://www.secg.org/SEC2-Ver-1.0.pdf</a></p>
</li>
<li>
<p><strong><a id="19"></a>[19]</strong> RECOMMENDED ELLIPTIC CURVES FOR FEDERAL GOVERNMENT USE (format PDF)&#160;: <a href="http://csrc.nist.gov/groups/ST/toolkit/documents/dss/NISTReCur.pdf" class="bare">http://csrc.nist.gov/groups/ST/toolkit/documents/dss/NISTReCur.pdf</a></p>
</li>
<li>
<p><strong><a id="20"></a>[20]</strong> Elliptic Curve Cryptography Subject Public Key Information&#160;: <a href="https://tools.ietf.org/html/rfc5480" class="bare">https://tools.ietf.org/html/rfc5480</a></p>
</li>
<li>
<p><strong><a id="21"></a>[21]</strong> "Courbe elliptique" sur WikipÃ©dia&#160;: <a href="https://fr.wikipedia.org/wiki/Courbe_elliptique#Additionner_les_points_:_d.C3.A9finition_par_la_m.C3.A9thode_des_tangentes_et_des_s.C3.A9cantes" class="bare">https://fr.wikipedia.org/wiki/Courbe_elliptique#Additionner_les_points_:_d.C3.A9finition_par_la_m.C3.A9thode_des_tangentes_et_des_s.C3.A9cantes</a></p>
</li>
<li>
<p><strong><a id="22"></a>[22]</strong> Article WikipÃ©dia sur l&#8217;inverse modulaire&#160;: <a href="https://fr.wikipedia.org/wiki/Inverse_modulaire" class="bare">https://fr.wikipedia.org/wiki/Inverse_modulaire</a></p>
</li>
<li>
<p><strong><a id="23"></a>[23]</strong> Conception d&#8217;algorithmes et applications (LI325) COURS 10 (format PDF)&#160;: <a href="http://www.di.ens.fr/~busic/cours/LI325/coursCAAC10.pdf" class="bare">http://www.di.ens.fr/~busic/cours/LI325/coursCAAC10.pdf</a></p>
</li>
<li>
<p><strong><a id="24"></a>[24]</strong> Elliptic curve digital signature algorithm&#160;: <a href="https://fr.wikipedia.org/wiki/Elliptic_curve_digital_signature_algorithm" class="bare">https://fr.wikipedia.org/wiki/Elliptic_curve_digital_signature_algorithm</a></p>
</li>
<li>
<p><strong><a id="25"></a>[25]</strong> ECC Tutorial (en anglais)&#160;: <a href="http://www.johannes-bauer.com/compsci/ecc" class="bare">http://www.johannes-bauer.com/compsci/ecc</a></p>
</li>
<li>
<p><strong><a id="26"></a>[26]</strong> Le 2D-Doc de l&#8217;ANTS&#160;: <a href="https://ants.gouv.fr/Les-solutions/2D-Doc" class="bare">https://ants.gouv.fr/Les-solutions/2D-Doc</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footnotes">
<hr>
<div class="footnote" id="_footnote_1">
<a href="#_footnoteref_1">1</a>. <em>RSA</em> permet Ã©galement de chiffrer.
</div>
<div class="footnote" id="_footnote_2">
<a href="#_footnoteref_2">2</a>. Nous utiliserons le fÃ©minin dans ce document. RFC Ã©tant un acronyme anglais, il n&#8217;y a pas d&#8217;argument dÃ©finitif pour l&#8217;emploi du masculin ou du fÃ©minin.
</div>
<div class="footnote" id="_footnote_3">
<a href="#_footnoteref_3">3</a>. Ici on a un peu simplifiÃ© les choses pour ne pas alourdir le texte. En fait l&#8217;Ã©metteur est identifiÃ© par son DN mais aussi par un <em>Serial Number</em>, nÃ©cessaire dans les cas oÃ¹ une mÃªme entitÃ© (DN) est associÃ©e Ã  diffÃ©rentes clÃ©s. Donc le lien hiÃ©rarchique est Ã©tabli avec le couple (DN, Serial Number), qui correspond Ã  un couple (DN, key) de maniÃ¨re unique. Le DN seul ne serait pas suffisant. Les identifiants de clÃ© correspondent (de maniÃ¨re bi-univoque) Ã  un couple (DN, key).
</div>
<div class="footnote" id="_footnote_4">
<a href="#_footnoteref_4">4</a>. On simplifie ici pour se concentrer sur les Ã©tapes importantes. En fait, le hash <em>M</em> calculÃ© n&#8217;est pas signÃ© tel quel, il subit auparavant quelques transformations comme nous le verrons plus loin.
</div>
<div class="footnote" id="_footnote_5">
<a href="#_footnoteref_5">5</a>. Ce calcul est le mÃªme que pour dÃ©chiffrer un message destinÃ© au propriÃ©taire de la clÃ© publique (qui est ici l&#8217;Ã©metteur du certificat). Signer en RSA revient Ã  chiffrer en inversant le rÃ´le de l&#8217;exposant public et privÃ©.
</div>
<div class="footnote" id="_footnote_6">
<a href="#_footnoteref_6">6</a>. Lorsque <em>bc</em> est lancÃ© avec l&#8217;option <strong><em>-l</em></strong>, des fonctions mathÃ©matiques sont chargÃ©es au dÃ©marrage et <em>scale</em> vaut 20. Nous ne nous servirons pas de cette option dans ce document et <em>scale</em> sera toujours Ã©gal Ã  zÃ©ro.
</div>
<div class="footnote" id="_footnote_7">
<a href="#_footnoteref_7">7</a>. <em>2 * 8</em> produit toujours 16 (dÃ©cimal). Si <em>16</em> est lu alors qu&#8217;ibase vaut dÃ©jÃ  16, le rÃ©sultat sera lu en hexadÃ©cimal et vaudra 22.
</div>
<div class="footnote" id="_footnote_8">
<a href="#_footnoteref_8">8</a>. <em>python</em> peut lire les nombres hexadÃ©cimaux indiffÃ©remment en majuscule et minuscule. <em>bc</em> exige des majuscules.
</div>
<div class="footnote" id="_footnote_9">
<a href="#_footnoteref_9">9</a>. Sous Windows, <em>bc</em> a des difficultÃ©s Ã  lire le caractÃ¨re <em>circonflexe</em> au clavier (en-dessous de la touche <strong>9</strong>). Pour contourner ce problÃ¨me, il est possible d&#8217;utiliser (sur un clavier franÃ§ais) l&#8217;accent circonflexe Ã  droite de la touche <strong>P</strong>, en appuyant dessus Ã  deux reprises. Cela affiche deux <em>circonflexes</em> et vous devez alors en supprimer un. Voir <a href="#7">[7]</a>.
</div>
<div class="footnote" id="_footnote_10">
<a href="#_footnoteref_10">10</a>. Si vous utilisez <em>python</em>, il est inutile de passer les caractÃ¨res hexadÃ©cimaux en majuscule.
</div>
<div class="footnote" id="_footnote_11">
<a href="#_footnoteref_11">11</a>. Par dÃ©faut, <em>bc</em> ajoute un anti-slash aprÃ¨s le 68e caractÃ¨re et passe Ã  la ligne suivante. On peut modifier ce comportement avec la variable d&#8217;environnement <em>BC_LINE_LENGTH</em>. Quand cette variable est Ã©gale Ã  zÃ©ro, les nombres ne sont pas coupÃ©s.
</div>
<div class="footnote" id="_footnote_12">
<a href="#_footnoteref_12">12</a>. BER signifie Basic Encoding Rules
</div>
<div class="footnote" id="_footnote_13">
<a href="#_footnoteref_13">13</a>. CER signifie Canonical Encoding Rules
</div>
<div class="footnote" id="_footnote_14">
<a href="#_footnoteref_14">14</a>. DER signifie Distinguished Encoding Rules
</div>
<div class="footnote" id="_footnote_15">
<a href="#_footnoteref_15">15</a>. La RFC 5280 indique que les <em>donnÃ©es signÃ©es</em> d&#8217;un certificat (la partie tbsCertificate) doivent Ãªtre encodÃ©es en DER, mais ne donne pas d&#8217;indication pour le reste.
</div>
<div class="footnote" id="_footnote_16">
<a href="#_footnoteref_16">16</a>. Certains types de donnÃ©es, notamment les <em>*string</em> (<code>OCTET&#160;STRING</code>, <code>UTF8String</code>, etc.), peuvent Ãªtre <em>primitive</em> ou <em>constructed</em>, ce qui signifie que leur encodage peut suivre une structure hiÃ©rarchique "propre Ã  l&#8217;encodage", non explicitÃ©e dans la dÃ©finition de la valeur en ASN.1.
</div>
<div class="footnote" id="_footnote_17">
<a href="#_footnoteref_17">17</a>. <em>pkfile</em> peut le faire aussi sous Linux, mais dans ce systÃ¨me il est plus logique d&#8217;utiliser les programmes dÃ©jÃ  installÃ©s. La fonctionnalitÃ© de calcul de hash a Ã©tÃ© ajoutÃ©e Ã  <em>pkfile</em> pour simplifier les manipulations sous Windows.
</div>
<div class="footnote" id="_footnote_18">
<a href="#_footnoteref_18">18</a>. Dans la signature ECDSA certains calculs sont faits modulo <em>n</em>, l&#8217;ordre du groupe associÃ© Ã  la courbe. Cela sera signalÃ©. Ã dÃ©faut, tous les calculs sont faits modulo <em>p</em>.
</div>
<div class="footnote" id="_footnote_19">
<a href="#_footnoteref_19">19</a>. Un peu plus loin la clÃ© privÃ©e sera notÃ©e <em>d</em>.
</div>
<div class="footnote" id="_footnote_20">
<a href="#_footnoteref_20">20</a>. Le standard X9.62 dÃ©finit <em>00</em> comme seul octet pour coder le point Ã  l&#8217;infini. La RFC 5480 interdit toute autre valeur que <em>02</em>, <em>03</em> et <em>04</em>, et interdit donc <em>00</em>. C&#8217;est logique car on ne voit pas dans quel but le point Ã  l&#8217;infini serait enregistrÃ© dans le cadre x509. Dans le standard x509, un point est une clÃ© publique.
</div>
<div class="footnote" id="_footnote_21">
<a href="#_footnoteref_21">21</a>. Enregistrer une clÃ© privÃ©e dans un fichier non chiffrÃ© est une mauvaise pratique. D&#8217;autre part le fichier doit Ãªtre enregistrÃ© dans un endroit parfaitement sÃ©curisÃ©, ne jamais Ãªtre transfÃ©rÃ© Ã  travers un rÃ©seau, etc. Ici cela n&#8217;a pas d&#8217;importance puisque la clÃ© est une clÃ© de test.
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.0.1<br>
Last updated 2016-05-01 11:35:38 CEST
</div>
</div>
</body>
</html>